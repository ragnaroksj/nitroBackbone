function sendMessage(e){process.stdout.write(JSON.stringify(e)+"\n")}var path=require("path"),fs=require("fs"),nodeunit=require("nodeunit"),filepaths=fs.readdirSync("test").map(function(e){return path.join("test",e)}),unfinished={},currentModule;process.on("uncaughtException",function(e){sendMessage({error:[e.name,e.message,e.stack]});process.exit()});var unfinished={};process.on("exit",function(e){var t=Object.keys(unfinished).length;t>0?sendMessage({exit:["UNFINISHED"]}):sendMessage({exit:["finished"]})});nodeunit.reporters.test={run:function(e,t,n){var r=e.map(function(e){return path.resolve(e)});nodeunit.runFiles(r,{testspec:undefined,moduleStart:function(e){currentModule=e;sendMessage({moduleStart:[e.toString()]})},moduleDone:function(e){if(e!==currentModule)return;sendMessage({moduleDone:[e.toString()]})},testStart:function(e){unfinished[e]=e;sendMessage({testStart:[e.toString()]})},testDone:function(e,t){delete unfinished[e];sendMessage({testDone:[e.toString(),t.failures(),t.map(function(e){var t=e.error;t&&(e.error={name:t.name,message:t.message,stack:t.stack});return e})]})},done:function(e){sendMessage({done:[e.failures(),e.duration,e]})}})}};nodeunit.reporters.test.run(filepaths,{});