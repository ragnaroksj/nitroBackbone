// Generated by CoffeeScript 1.3.3
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft={}.hasOwnProperty,lt=function(e,t){function r(){this.constructor=e}for(var n in t)ft.call(t,n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},ct=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};F=require("./scope").Scope;ut=require("./lexer"),D=ut.RESERVED,j=ut.STRICT_PROSCRIBED;at=require("./helpers"),Q=at.compact,et=at.flatten,Z=at.extend,nt=at.merge,G=at.del,it=at.starts,Y=at.ends,tt=at.last;exports.extend=Z;K=function(){return!0};L=function(){return!1};z=function(){return this};k=function(){this.negated=!this.negated;return this};exports.Base=r=function(){function e(){}e.prototype.compile=function(e,t){var n;e=Z({},e);t&&(e.level=t);n=this.unfoldSoak(e)||this;n.tab=e.indent;return e.level===T||!n.isStatement(e)?n.compileNode(e):n.compileClosure(e)};e.prototype.compileClosure=function(e){if(this.jumps())throw SyntaxError("cannot use a pure statement in an expression.");e.sharedScope=!0;return u.wrap(this).compileNode(e)};e.prototype.cache=function(e,t,r){var i,s;if(!this.isComplex()){i=t?this.compile(e,t):this;return[i,i]}i=new N(r||e.scope.freeVariable("ref"));s=new n(i,this);return t?[s.compile(e,t),i.value]:[s,i]};e.prototype.compileLoopReference=function(e,t){var n,r;n=r=this.compile(e,E);-Infinity<+n&&+n<Infinity||p.test(n)&&e.scope.check(n,!0)||(n=""+(r=e.scope.freeVariable(t))+" = "+n);return[n,r]};e.prototype.makeReturn=function(e){var t;t=this.unwrapAll();return e?new s(new N(""+e+".push"),[t]):new H(t)};e.prototype.contains=function(e){var t;t=!1;this.traverseChildren(!1,function(n){if(e(n)){t=!0;return!1}});return t};e.prototype.containsType=function(e){return this instanceof e||this.contains(function(t){return t instanceof e})};e.prototype.lastNonComment=function(e){var t;t=e.length;while(t--)if(!(e[t]instanceof f))return e[t];return null};e.prototype.toString=function(e,t){var n;e==null&&(e="");t==null&&(t=this.constructor.name);n="\n"+e+t;this.soak&&(n+="?");this.eachChild(function(t){return n+=t.toString(e+U)});return n};e.prototype.eachChild=function(e){var t,n,r,i,s,o,u,a;if(!this.children)return this;u=this.children;for(r=0,s=u.length;r<s;r++){t=u[r];if(this[t]){a=et([this[t]]);for(i=0,o=a.length;i<o;i++){n=a[i];if(e(n)===!1)return this}}}return this};e.prototype.traverseChildren=function(e,t){return this.eachChild(function(n){return t(n)===!1?!1:n.traverseChildren(e,t)})};e.prototype.invert=function(){return new O("!",this)};e.prototype.unwrapAll=function(){var e;e=this;while(e!==(e=e.unwrap()))continue;return e};e.prototype.children=[];e.prototype.isStatement=L;e.prototype.jumps=L;e.prototype.isComplex=K;e.prototype.isChainable=L;e.prototype.isAssignable=L;e.prototype.unwrap=z;e.prototype.unfoldSoak=L;e.prototype.assigns=L;return e}();exports.Block=i=function(e){function t(e){this.expressions=Q(et(e||[]))}lt(t,e);t.prototype.children=["expressions"];t.prototype.push=function(e){this.expressions.push(e);return this};t.prototype.pop=function(){return this.expressions.pop()};t.prototype.unshift=function(e){this.expressions.unshift(e);return this};t.prototype.unwrap=function(){return this.expressions.length===1?this.expressions[0]:this};t.prototype.isEmpty=function(){return!this.expressions.length};t.prototype.isStatement=function(e){var t,n,r,i;i=this.expressions;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.isStatement(e))return!0}return!1};t.prototype.jumps=function(e){var t,n,r,i;i=this.expressions;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.jumps(e))return t}};t.prototype.makeReturn=function(e){var t,n;n=this.expressions.length;while(n--){t=this.expressions[n];if(!(t instanceof f)){this.expressions[n]=t.makeReturn(e);t instanceof H&&!t.expression&&this.expressions.splice(n,1);break}}return this};t.prototype.compile=function(e,n){e==null&&(e={});return e.scope?t.__super__.compile.call(this,e,n):this.compileRoot(e)};t.prototype.compileNode=function(e){var n,r,i,s,o,u,a;this.tab=e.indent;s=e.level===T;r=[];a=this.expressions;for(o=0,u=a.length;o<u;o++){i=a[o];i=i.unwrapAll();i=i.unfoldSoak(e)||i;if(i instanceof t)r.push(i.compileNode(e));else if(s){i.front=!0;n=i.compile(e);if(!i.isStatement(e)){n=""+this.tab+n+";";i instanceof N&&(n=""+n+"\n")}r.push(n)}else r.push(i.compile(e,E))}if(s)return this.spaced?"\n"+r.join("\n\n")+"\n":r.join("\n");n=r.join(", ")||"void 0";return r.length>1&&e.level>=E?"("+n+")":n};t.prototype.compileRoot=function(e){var t,n,r,i,s,o;e.indent=e.bare?"":U;e.scope=new F(null,this,null);e.level=T;this.spaced=!0;i="";if(!e.bare){s=function(){var e,t,i,s;i=this.expressions;s=[];for(r=e=0,t=i.length;e<t;r=++e){n=i[r];if(!(n.unwrap()instanceof f))break;s.push(n)}return s}.call(this);o=this.expressions.slice(s.length);this.expressions=s;s.length&&(i=""+this.compileNode(nt(e,{indent:""}))+"\n");this.expressions=o}t=this.compileWithDeclarations(e);return e.bare?t:""+i+"(function() {\n"+t+"\n}).call(this);\n"};t.prototype.compileWithDeclarations=function(e){var t,n,r,i,s,o,u,a,l,c,h,p,d,v;n=o="";p=this.expressions;for(s=c=0,h=p.length;c<h;s=++c){i=p[s];i=i.unwrap();if(!(i instanceof f||i instanceof N))break}e=nt(e,{level:T});if(s){u=this.expressions.splice(s,9e9);d=[this.spaced,!1],l=d[0],this.spaced=d[1];v=[this.compileNode(e),l],n=v[0],this.spaced=v[1];this.expressions=u}o=this.compileNode(e);a=e.scope;if(a.expressions===this){r=e.scope.hasDeclarations();t=a.hasAssignments;if(r||t){s&&(n+="\n");n+=""+this.tab+"var ";r&&(n+=a.declaredVariables().join(", "));if(t){r&&(n+=",\n"+(this.tab+U));n+=a.assignedVariables().join(",\n"+(this.tab+U))}n+=";\n"}}return n+o};t.wrap=function(e){return e.length===1&&e[0]instanceof t?e[0]:new t(e)};return t}(r);exports.Literal=N=function(e){function t(e){this.value=e}lt(t,e);t.prototype.makeReturn=function(){return this.isStatement()?this:t.__super__.makeReturn.apply(this,arguments)};t.prototype.isAssignable=function(){return p.test(this.value)};t.prototype.isStatement=function(){var e;return(e=this.value)==="break"||e==="continue"||e==="debugger"};t.prototype.isComplex=L;t.prototype.assigns=function(e){return e===this.value};t.prototype.jumps=function(e){if(this.value==="break"&&!((e!=null?e.loop:void 0)||(e!=null?e.block:void 0)))return this;if(this.value==="continue"&&(e!=null?!e.loop:!void 0))return this};t.prototype.compileNode=function(e){var t,n;t=this.value==="this"?((n=e.scope.method)!=null?n.bound:void 0)?e.scope.method.context:this.value:this.value.reserved?'"'+this.value+'"':this.value;return this.isStatement()?""+this.tab+t+";":t};t.prototype.toString=function(){return' "'+this.value+'"'};return t}(r);exports.Undefined=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}lt(t,e);t.prototype.isAssignable=L;t.prototype.isComplex=L;t.prototype.compileNode=function(e){return e.level>=b?"(void 0)":"void 0"};return t}(r);exports.Null=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}lt(t,e);t.prototype.isAssignable=L;t.prototype.isComplex=L;t.prototype.compileNode=function(){return"null"};return t}(r);exports.Bool=function(e){function t(e){this.val=e}lt(t,e);t.prototype.isAssignable=L;t.prototype.isComplex=L;t.prototype.compileNode=function(){return this.val};return t}(r);exports.Return=H=function(e){function t(e){e&&!e.unwrap().isUndefined&&(this.expression=e)}lt(t,e);t.prototype.children=["expression"];t.prototype.isStatement=K;t.prototype.makeReturn=z;t.prototype.jumps=z;t.prototype.compile=function(e,n){var r,i;r=(i=this.expression)!=null?i.makeReturn():void 0;return!r||r instanceof t?t.__super__.compile.call(this,e,n):r.compile(e,n)};t.prototype.compileNode=function(e){return this.tab+("return"+[this.expression?" "+this.expression.compile(e,x):void 0]+";")};return t}(r);exports.Value=$=function(e){function r(e,t,n){if(!t&&e instanceof r)return e;this.base=e;this.properties=t||[];n&&(this[n]=!0);return this}lt(r,e);r.prototype.children=["base","properties"];r.prototype.add=function(e){this.properties=this.properties.concat(e);return this};r.prototype.hasProperties=function(){return!!this.properties.length};r.prototype.isArray=function(){return!this.properties.length&&this.base instanceof t};r.prototype.isComplex=function(){return this.hasProperties()||this.base.isComplex()};r.prototype.isAssignable=function(){return this.hasProperties()||this.base.isAssignable()};r.prototype.isSimpleNumber=function(){return this.base instanceof N&&B.test(this.base.value)};r.prototype.isString=function(){return this.base instanceof N&&v.test(this.base.value)};r.prototype.isAtomic=function(){var e,t,n,r;r=this.properties.concat(this.base);for(t=0,n=r.length;t<n;t++){e=r[t];if(e.soak||e instanceof s)return!1}return!0};r.prototype.isStatement=function(e){return!this.properties.length&&this.base.isStatement(e)};r.prototype.assigns=function(e){return!this.properties.length&&this.base.assigns(e)};r.prototype.jumps=function(e){return!this.properties.length&&this.base.jumps(e)};r.prototype.isObject=function(e){return this.properties.length?!1:this.base instanceof A&&(!e||this.base.generated)};r.prototype.isSplice=function(){return tt(this.properties)instanceof I};r.prototype.unwrap=function(){return this.properties.length?this:this.base};r.prototype.cacheReference=function(e){var t,i,s,o;s=tt(this.properties);if(this.properties.length<2&&!this.base.isComplex()&&(s!=null?!s.isComplex():!void 0))return[this,this];t=new r(this.base,this.properties.slice(0,-1));if(t.isComplex()){i=new N(e.scope.freeVariable("base"));t=new r(new _(new n(i,t)))}if(!s)return[t,i];if(s.isComplex()){o=new N(e.scope.freeVariable("name"));s=new y(new n(o,s.index));o=new y(o)}return[t.add(s),new r(i||t.base,[o||s])]};r.prototype.compileNode=function(e){var t,n,r,i,s;this.base.front=this.front;r=this.properties;t=this.base.compile(e,r.length?b:null);(this.base instanceof _||r.length)&&B.test(t)&&(t=""+t+".");for(i=0,s=r.length;i<s;i++){n=r[i];t+=n.compile(e)}return t};r.prototype.unfoldSoak=function(e){var t,i=this;if(this.unfoldedSoak!=null)return this.unfoldedSoak;t=function(){var t,s,o,u,a,f,c,h,p;if(o=i.base.unfoldSoak(e)){Array.prototype.push.apply(o.body.properties,i.properties);return o}p=i.properties;for(s=c=0,h=p.length;c<h;s=++c){u=p[s];if(!u.soak)continue;u.soak=!1;t=new r(i.base,i.properties.slice(0,s));f=new r(i.base,i.properties.slice(s));if(t.isComplex()){a=new N(e.scope.freeVariable("ref"));t=new _(new n(a,t));f.base=a}return new m(new l(t),f,{soak:!0})}return null}();return this.unfoldedSoak=t||!1};return r}(r);exports.Comment=f=function(e){function t(e){this.comment=e}lt(t,e);t.prototype.isStatement=K;t.prototype.makeReturn=z;t.prototype.compileNode=function(e,t){var n;n="/*"+rt(this.comment,this.tab)+("\n"+this.tab+"*/\n");(t||e.level)===T&&(n=e.indent+n);return n};return t}(r);exports.Call=s=function(t){function r(e,t,n){this.args=t!=null?t:[];this.soak=n;this.isNew=!1;this.isSuper=e==="super";this.variable=this.isSuper?null:e}lt(r,t);r.prototype.children=["variable","args"];r.prototype.newInstance=function(){var e,t;e=((t=this.variable)!=null?t.base:void 0)||this.variable;e instanceof r&&!e.isNew?e.newInstance():this.isNew=!0;return this};r.prototype.superReference=function(t){var n,r,i;r=t.scope.namedMethod();if(!r)throw SyntaxError("cannot call super outside of a function.");i=r.name;if(i==null)throw SyntaxError("cannot call super on an anonymous function.");if(r.klass){n=[new e(new N("__super__"))];r["static"]&&n.push(new e(new N("constructor")));n.push(new e(new N(i)));return(new $(new N(r.klass),n)).compile(t)}return""+i+".__super__.constructor"};r.prototype.superThis=function(e){var t;t=e.scope.method;return t&&!t.klass&&t.context||"this"};r.prototype.unfoldSoak=function(e){var t,n,i,s,o,u,a,f,l;if(this.soak){if(this.variable){if(n=st(e,this,"variable"))return n;f=(new $(this.variable)).cacheReference(e),i=f[0],o=f[1]}else{i=new N(this.superReference(e));o=new $(i)}o=new r(o,this.args);o.isNew=this.isNew;i=new N("typeof "+i.compile(e)+' === "function"');return new m(i,new $(o),{soak:!0})}t=this;s=[];for(;;){if(t.variable instanceof r){s.push(t);t=t.variable;continue}if(!(t.variable instanceof $))break;s.push(t);if(!((t=t.variable.base)instanceof r))break}l=s.reverse();for(u=0,a=l.length;u<a;u++){t=l[u];n&&(t.variable instanceof r?t.variable=n:t.variable.base=n);n=st(e,t,"variable")}return n};r.prototype.filterImplicitObjects=function(e){var t,r,i,s,o,u,a,l,c,h;r=[];for(u=0,l=e.length;u<l;u++){t=e[u];if(!((typeof t.isObject=="function"?t.isObject():void 0)&&t.base.generated)){r.push(t);continue}i=null;h=t.base.properties;for(a=0,c=h.length;a<c;a++){s=h[a];if(s instanceof n||s instanceof f){i||r.push(i=new A(o=[],!0));o.push(s)}else{r.push(s);i=null}}}return r};r.prototype.compileNode=function(e){var t,n,r,i;(i=this.variable)!=null&&(i.front=this.front);if(r=q.compileSplattedArray(e,this.args,!0))return this.compileSplat(e,r);n=this.filterImplicitObjects(this.args);n=function(){var r,i,s;s=[];for(r=0,i=n.length;r<i;r++){t=n[r];s.push(t.compile(e,E))}return s}().join(", ");return this.isSuper?this.superReference(e)+(".call("+this.superThis(e)+(n&&", "+n)+")"):(this.isNew?"new ":"")+this.variable.compile(e,b)+("("+n+")")};r.prototype.compileSuper=function(e,t){return""+this.superReference(t)+".call("+this.superThis(t)+(e.length?", ":"")+e+")"};r.prototype.compileSplat=function(e,t){var n,r,i,s,o;if(this.isSuper)return""+this.superReference(e)+".apply("+this.superThis(e)+", "+t+")";if(this.isNew){i=this.tab+U;return"(function(func, args, ctor) {\n"+i+"ctor.prototype = func.prototype;\n"+i+"var child = new ctor, result = func.apply(child, args), t = typeof result;\n"+i+'return t == "object" || t == "function" ? result || child : child;\n'+this.tab+"})("+this.variable.compile(e,E)+", "+t+", function(){})"}n=new $(this.variable);if((s=n.properties.pop())&&n.isComplex()){o=e.scope.freeVariable("ref");r="("+o+" = "+n.compile(e,E)+")"+s.compile(e)}else{r=n.compile(e,b);B.test(r)&&(r="("+r+")");if(s){o=r;r+=s.compile(e)}else o="null"}return""+r+".apply("+o+", "+t+")"};return r}(r);exports.Extends=c=function(e){function t(e,t){this.child=e;this.parent=t}lt(t,e);t.prototype.children=["child","parent"];t.prototype.compile=function(e){return(new s(new $(new N(ot("extends"))),[this.child,this.parent])).compile(e)};return t}(r);exports.Access=e=function(e){function t(e,t){this.name=e;this.name.asKey=!0;this.soak=t==="soak"}lt(t,e);t.prototype.children=["name"];t.prototype.compile=function(e){var t;t=this.name.compile(e);return p.test(t)?"."+t:"["+t+"]"};t.prototype.isComplex=L;return t}(r);exports.Index=y=function(e){function t(e){this.index=e}lt(t,e);t.prototype.children=["index"];t.prototype.compile=function(e){return"["+this.index.compile(e,x)+"]"};t.prototype.isComplex=function(){return this.index.isComplex()};return t}(r);exports.Range=P=function(e){function t(e,t,n){this.from=e;this.to=t;this.exclusive=n==="exclusive";this.equals=this.exclusive?"":"="}lt(t,e);t.prototype.children=["from","to"];t.prototype.compileVariables=function(e){var t,n,r,i,s;e=nt(e,{top:!0});n=this.from.cache(e,E),this.fromC=n[0],this.fromVar=n[1];r=this.to.cache(e,E),this.toC=r[0],this.toVar=r[1];if(t=G(e,"step"))i=t.cache(e,E),this.step=i[0],this.stepVar=i[1];s=[this.fromVar.match(B),this.toVar.match(B)],this.fromNum=s[0],this.toNum=s[1];if(this.stepVar)return this.stepNum=this.stepVar.match(B)};t.prototype.compileNode=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;this.fromVar||this.compileVariables(e);if(!e.index)return this.compileArray(e);u=this.fromNum&&this.toNum;s=G(e,"index");o=G(e,"name");f=o&&o!==s;h=""+s+" = "+this.fromC;this.toC!==this.toVar&&(h+=", "+this.toC);this.step!==this.stepVar&&(h+=", "+this.step);p=[""+s+" <"+this.equals,""+s+" >"+this.equals],a=p[0],i=p[1];n=this.stepNum?+this.stepNum>0?""+a+" "+this.toVar:""+i+" "+this.toVar:u?(d=[+this.fromNum,+this.toNum],r=d[0],c=d[1],d,r<=c?""+a+" "+c:""+i+" "+c):(t=""+this.fromVar+" <= "+this.toVar,""+t+" ? "+a+" "+this.toVar+" : "+i+" "+this.toVar);l=this.stepVar?""+s+" += "+this.stepVar:u?f?r<=c?"++"+s:"--"+s:r<=c?""+s+"++":""+s+"--":f?""+t+" ? ++"+s+" : --"+s:""+t+" ? "+s+"++ : "+s+"--";f&&(h=""+o+" = "+h);f&&(l=""+o+" = "+l);return""+h+"; "+n+"; "+l};t.prototype.compileArray=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;if(this.fromNum&&this.toNum&&Math.abs(this.fromNum-this.toNum)<=20){f=function(){v=[];for(var e=p=+this.fromNum,t=+this.toNum;p<=t?e<=t:e>=t;p<=t?e++:e--)v.push(e);return v}.apply(this);this.exclusive&&f.pop();return"["+f.join(", ")+"]"}o=this.tab+U;s=e.scope.freeVariable("i");l=e.scope.freeVariable("results");a="\n"+o+l+" = [];";if(this.fromNum&&this.toNum){e.index=s;n=this.compileNode(e)}else{c=""+s+" = "+this.fromC+(this.toC!==this.toVar?", "+this.toC:"");r=""+this.fromVar+" <= "+this.toVar;n="var "+c+"; "+r+" ? "+s+" <"+this.equals+" "+this.toVar+" : "+s+" >"+this.equals+" "+this.toVar+"; "+r+" ? "+s+"++ : "+s+"--"}u="{ "+l+".push("+s+"); }\n"+o+"return "+l+";\n"+e.indent;i=function(e){return e!=null?e.contains(function(e){return e instanceof N&&e.value==="arguments"&&!e.asKey}):void 0};if(i(this.from)||i(this.to))t=", arguments";return"(function() {"+a+"\n"+o+"for ("+n+")"+u+"}).apply(this"+(t!=null?t:"")+")"};return t}(r);exports.Slice=I=function(e){function t(e){this.range=e;t.__super__.constructor.call(this)}lt(t,e);t.prototype.children=["range"];t.prototype.compileNode=function(e){var t,n,r,i,s,o;o=this.range,i=o.to,n=o.from;r=n&&n.compile(e,x)||"0";t=i&&i.compile(e,x);i&&(!!this.range.exclusive||+t!==-1)&&(s=", "+(this.range.exclusive?t:B.test(t)?""+(+t+1):(t=i.compile(e,b),""+t+" + 1 || 9e9")));return".slice("+r+(s||"")+")"};return t}(r);exports.Obj=A=function(e){function t(e,t){this.generated=t!=null?t:!1;this.objects=this.properties=e||[]}lt(t,e);t.prototype.children=["properties"];t.prototype.compileNode=function(e){var t,r,i,s,o,u,a,l,c,h,p,d,v,m,g,y;p=this.properties;h=[];y=this.properties;for(d=0,m=y.length;d<m;d++){l=y[d];l.isComplex()&&(l=l.variable);if(l!=null){c=l.unwrapAll().value.toString();if(ct.call(h,c)>=0)throw SyntaxError('multiple object literal properties named "'+c+'"');h.push(c)}}if(!p.length)return this.front?"({})":"{}";if(this.generated)for(v=0,g=p.length;v<g;v++){u=p[v];if(u instanceof $)throw new Error("cannot have an implicit value in an implicit object")}r=e.indent+=U;o=this.lastNonComment(this.properties);p=function(){var u,a,c;c=[];for(t=u=0,a=p.length;u<a;t=++u){l=p[t];s=t===p.length-1?"":l===o||l instanceof f?"\n":",\n";i=l instanceof f?"":r;l instanceof $&&l["this"]&&(l=new n(l.properties[0].name,l,"object"));if(!(l instanceof f)){l instanceof n||(l=new n(l,l,"object"));(l.variable.base||l.variable).asKey=!0}c.push(i+l.compile(e,T)+s)}return c}();p=p.join("");a="{"+(p&&"\n"+p+"\n"+this.tab)+"}";return this.front?"("+a+")":a};t.prototype.assigns=function(e){var t,n,r,i;i=this.properties;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.assigns(e))return!0}return!1};return t}(r);exports.Arr=t=function(e){function t(e){this.objects=e||[]}lt(t,e);t.prototype.children=["objects"];t.prototype.filterImplicitObjects=s.prototype.filterImplicitObjects;t.prototype.compileNode=function(e){var t,n,r;if(!this.objects.length)return"[]";e.indent+=U;r=this.filterImplicitObjects(this.objects);if(t=q.compileSplattedArray(e,r))return t;t=function(){var t,i,s;s=[];for(t=0,i=r.length;t<i;t++){n=r[t];s.push(n.compile(e,E))}return s}().join(", ");return t.indexOf("\n")>=0?"[\n"+e.indent+t+"\n"+this.tab+"]":"["+t+"]"};t.prototype.assigns=function(e){var t,n,r,i;i=this.objects;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.assigns(e))return!0}return!1};return t}(r);exports.Class=o=function(t){function r(e,t,n){this.variable=e;this.parent=t;this.body=n!=null?n:new i;this.boundFuncs=[];this.body.classBody=!0}lt(r,t);r.prototype.children=["variable","parent","body"];r.prototype.determineName=function(){var t,n;if(!this.variable)return null;t=(n=tt(this.variable.properties))?n instanceof e&&n.name.value:this.variable.base.value;if(ct.call(j,t)>=0)throw SyntaxError("variable name may not be "+t);return t&&(t=p.test(t)&&t)};r.prototype.setContext=function(e){return this.body.traverseChildren(!1,function(t){if(t.classBody)return!1;if(t instanceof N&&t.value==="this")return t.value=e;if(t instanceof a){t.klass=e;if(t.bound)return t.context=e}})};r.prototype.addBoundFunctions=function(t){var n,r,i,s,o,u;if(this.boundFuncs.length){o=this.boundFuncs;u=[];for(i=0,s=o.length;i<s;i++){n=o[i];r=(new $(new N("this"),[new e(n)])).compile(t);u.push(this.ctor.body.unshift(new N(""+r+" = "+ot("bind")+"("+r+", this)")))}return u}};r.prototype.addProperties=function(t,r,i){var s,o,u,f,l;l=t.base.properties.slice(0);u=function(){var t;t=[];while(s=l.shift()){if(s instanceof n){o=s.variable.base;delete s.context;f=s.value;if(o.value==="constructor"){if(this.ctor)throw new Error("cannot define more than one constructor in a class");if(f.bound)throw new Error("cannot define a constructor as a bound function");if(f instanceof a)s=this.ctor=f;else{this.externalCtor=i.scope.freeVariable("class");s=new n(new N(this.externalCtor),f)}}else if(s.variable["this"]){f["static"]=!0;f.bound&&(f.context=r)}else{s.variable=new $(new N(r),[new e(new N("prototype")),new e(o)]);if(f instanceof a&&f.bound){this.boundFuncs.push(o);f.bound=!1}}}t.push(s)}return t}.call(this);return Q(u)};r.prototype.walkBody=function(e,t){var n=this;return this.traverseChildren(!1,function(s){var o,u,a,f,l,c;if(s instanceof r)return!1;if(s instanceof i){c=o=s.expressions;for(u=f=0,l=c.length;f<l;u=++f){a=c[u];a instanceof $&&a.isObject(!0)&&(o[u]=n.addProperties(a,e,t))}return s.expressions=o=et(o)}})};r.prototype.hoistDirectivePrologue=function(){var e,t,n;t=0;e=this.body.expressions;while((n=e[t])&&n instanceof f||n instanceof $&&n.isString())++t;return this.directives=e.splice(0,t)};r.prototype.ensureConstructor=function(e){if(!this.ctor){this.ctor=new a;this.parent&&this.ctor.body.push(new N(""+e+".__super__.constructor.apply(this, arguments)"));this.externalCtor&&this.ctor.body.push(new N(""+this.externalCtor+".apply(this, arguments)"));this.ctor.body.makeReturn();this.body.expressions.unshift(this.ctor)}this.ctor.ctor=this.ctor.name=e;this.ctor.klass=null;return this.ctor.noReturn=!0};r.prototype.compileNode=function(e){var t,r,i,s,o,f,l;r=this.determineName();o=r||"_Class";o.reserved&&(o="_"+o);s=new N(o);this.hoistDirectivePrologue();this.setContext(o);this.walkBody(o,e);this.ensureConstructor(o);this.body.spaced=!0;this.ctor instanceof a||this.body.expressions.unshift(this.ctor);this.body.expressions.push(s);(l=this.body.expressions).unshift.apply(l,this.directives);this.addBoundFunctions(e);t=u.wrap(this.body);if(this.parent){this.superClass=new N(e.scope.freeVariable("super",!1));this.body.expressions.unshift(new c(s,this.superClass));t.args.push(this.parent);f=t.variable.params||t.variable.base.params;f.push(new M(this.superClass))}i=new _(t,!0);this.variable&&(i=new n(this.variable,i));return i.compile(e)};return r}(r);exports.Assign=n=function(t){function n(e,t,n,r){var i,s,o;this.variable=e;this.value=t;this.context=n;this.param=r&&r.param;this.subpattern=r&&r.subpattern;i=(o=s=this.variable.unwrapAll().value,ct.call(j,o)>=0);if(i&&this.context!=="object")throw SyntaxError('variable name may not be "'+s+'"')}lt(n,t);n.prototype.children=["variable","value"];n.prototype.isStatement=function(e){return(e!=null?e.level:void 0)===T&&this.context!=null&&ct.call(this.context,"?")>=0};n.prototype.assigns=function(e){return this[this.context==="object"?"value":"variable"].assigns(e)};n.prototype.unfoldSoak=function(e){return st(e,this,"variable")};n.prototype.compileNode=function(e){var t,n,r,i,s,o,u,f,l;if(t=this.variable instanceof $){if(this.variable.isArray()||this.variable.isObject())return this.compilePatternMatch(e);if(this.variable.isSplice())return this.compileSplice(e);if((o=this.context)==="||="||o==="&&="||o==="?=")return this.compileConditional(e)}r=this.variable.compile(e,E);if(!this.context){if(!(s=this.variable.unwrapAll()).isAssignable())throw SyntaxError('"'+this.variable.compile(e)+'" cannot be assigned.');if(typeof s.hasProperties=="function"?!s.hasProperties():!void 0)this.param?e.scope.add(r,"var"):e.scope.find(r)}if(this.value instanceof a&&(n=C.exec(r))){n[1]&&(this.value.klass=n[1]);this.value.name=(u=(f=(l=n[2])!=null?l:n[3])!=null?f:n[4])!=null?u:n[5]}i=this.value.compile(e,E);if(this.context==="object")return""+r+": "+i;i=r+(" "+(this.context||"=")+" ")+i;return e.level<=E?i:"("+i+")"};n.prototype.compilePatternMatch=function(t){var r,i,s,o,u,a,f,l,c,h,d,v,m,g,b,w,x,C,k,L,A,O,M,P,H,B,j;b=t.level===T;x=this.value;h=this.variable.base.objects;if(!(d=h.length)){s=x.compile(t);return t.level>=S?"("+s+")":s}a=this.variable.isObject();if(b&&d===1&&!((c=h[0])instanceof q)){c instanceof n?(A=c,O=A.variable,u=O.base,c=A.value):c.base instanceof _?(M=(new $(c.unwrapAll())).cacheReference(t),c=M[0],u=M[1]):u=a?c["this"]?c.properties[0].name:c:new N(0);r=p.test(u.unwrap().value||0);x=new $(x);x.properties.push(new(r?e:y)(u));if(P=c.unwrap().value,ct.call(D,P)>=0)throw new SyntaxError("assignment to a reserved word: "+c.compile(t)+" = "+x.compile(t));return(new n(c,x,null,{param:this.param})).compile(t,T)}C=x.compile(t,E);i=[];g=!1;if(!p.test(C)||this.variable.assigns(C)){i.push(""+(v=t.scope.freeVariable("ref"))+" = "+C);C=v}for(o=k=0,L=h.length;k<L;o=++k){c=h[o];u=o;a&&(c instanceof n?(H=c,B=H.variable,u=B.base,c=H.value):c.base instanceof _?(j=(new $(c.unwrapAll())).cacheReference(t),c=j[0],u=j[1]):u=c["this"]?c.properties[0].name:c);if(!g&&c instanceof q){l=c.name.unwrap().value;c=c.unwrap();w=""+d+" <= "+C+".length ? "+ot("slice")+".call("+C+", "+o;if(m=d-o-1){f=t.scope.freeVariable("i");w+=", "+f+" = "+C+".length - "+m+") : ("+f+" = "+o+", [])"}else w+=") : []";w=new N(w);g=""+f+"++"}else{l=c.unwrap().value;if(c instanceof q){c=c.name.compile(t);throw new SyntaxError("multiple splats are disallowed in an assignment: "+c+"...")}if(typeof u=="number"){u=new N(g||u);r=!1}else r=a&&p.test(u.unwrap().value||0);w=new $(new N(C),[new(r?e:y)(u)])}if(l!=null&&ct.call(D,l)>=0)throw new SyntaxError("assignment to a reserved word: "+c.compile(t)+" = "+w.compile(t));i.push((new n(c,w,null,{param:this.param,subpattern:!0})).compile(t,E))}!b&&!this.subpattern&&i.push(C);s=i.join(", ");return t.level<E?s:"("+s+")"};n.prototype.compileConditional=function(e){var t,r,i;i=this.variable.cacheReference(e),t=i[0],r=i[1];if(!t.properties.length&&t.base instanceof N&&t.base.value!=="this"&&!e.scope.check(t.base.value))throw new Error('the variable "'+t.base.value+"\" can't be assigned with "+this.context+" because it has not been defined.");ct.call(this.context,"?")>=0&&(e.isExistentialEquals=!0);return(new O(this.context.slice(0,-1),t,new n(r,this.value,"="))).compile(e)};n.prototype.compileSplice=function(e){var t,n,r,i,s,o,u,a,f,l,c,h;l=this.variable.properties.pop().range,r=l.from,u=l.to,n=l.exclusive;o=this.variable.compile(e);c=(r!=null?r.cache(e,S):void 0)||["0","0"],i=c[0],s=c[1];if(u)if((r!=null?r.isSimpleNumber():void 0)&&u.isSimpleNumber()){u=+u.compile(e)- +s;n||(u+=1)}else{u=u.compile(e,b)+" - "+s;n||(u+=" + 1")}else u="9e9";h=this.value.cache(e,E),a=h[0],f=h[1];t="[].splice.apply("+o+", ["+i+", "+u+"].concat("+a+")), "+f;return e.level>T?"("+t+")":t};return n}(r);exports.Code=a=function(e){function r(e,t,n){this.params=e||[];this.body=t||new i;this.bound=n==="boundfunc";this.bound&&(this.context="_this")}lt(r,e);r.prototype.children=["params","body"];r.prototype.isStatement=function(){return!!this.ctor};r.prototype.jumps=L;r.prototype.compileNode=function(e){var r,i,s,o,u,a,f,l,c,h,p,d,v,g,y,w,E,S,x,T,C,k,L,A,M,_,D,P,H,B,j,I,q;e.scope=new F(e.scope,this.body,this);e.scope.shared=G(e,"sharedScope");e.indent+=U;delete e.bare;delete e.isExistentialEquals;c=[];i=[];D=this.paramNames();for(y=0,x=D.length;y<x;y++){a=D[y];e.scope.check(a)||e.scope.parameter(a)}P=this.params;for(w=0,T=P.length;w<T;w++){l=P[w];if(!l.splat)continue;H=this.params;for(E=0,C=H.length;E<C;E++){f=H[E].name;f["this"]&&(f=f.properties[0].name);f.value&&e.scope.add(f.value,"var",!0)}p=new n(new $(new t(function(){var t,n,r,i;r=this.params;i=[];for(t=0,n=r.length;t<n;t++){f=r[t];i.push(f.asReference(e))}return i}.call(this))),new $(new N("arguments")));break}B=this.params;for(S=0,k=B.length;S<k;S++){l=B[S];if(l.isComplex()){v=h=l.asReference(e);l.value&&(v=new O("?",h,l.value));i.push(new n(new $(l.name),v,"=",{param:!0}))}else{h=l;if(l.value){u=new N(h.name.value+" == null");v=new n(new $(l.name),l.value,"=");i.push(new m(u,v))}}p||c.push(h)}g=this.body.isEmpty();p&&i.unshift(p);i.length&&(j=this.body.expressions).unshift.apply(j,i);for(s=M=0,L=c.length;M<L;s=++M){f=c[s];e.scope.parameter(c[s]=f.compile(e))}d=[];I=this.paramNames();for(_=0,A=I.length;_<A;_++){a=I[_];if(ct.call(d,a)>=0)throw SyntaxError("multiple parameters named '"+a+"'");d.push(a)}!g&&!this.noReturn&&this.body.makeReturn();this.bound&&(((q=e.scope.parent.method)!=null?q.bound:void 0)?this.bound=this.context=e.scope.parent.method.context:this["static"]||e.scope.parent.assign("_this","this"));o=e.indent;r="function";this.ctor&&(r+=" "+this.name);r+="("+c.join(", ")+") {";this.body.isEmpty()||(r+="\n"+this.body.compileWithDeclarations(e)+"\n"+this.tab);r+="}";return this.ctor?this.tab+r:this.front||e.level>=b?"("+r+")":r};r.prototype.paramNames=function(){var e,t,n,r,i;e=[];i=this.params;for(n=0,r=i.length;n<r;n++){t=i[n];e.push.apply(e,t.names())}return e};r.prototype.traverseChildren=function(e,t){if(e)return r.__super__.traverseChildren.call(this,e,t)};return r}(r);exports.Param=M=function(e){function t(e,t,n){var r;this.name=e;this.value=t;this.splat=n;if(r=e=this.name.unwrapAll().value,ct.call(j,r)>=0)throw SyntaxError('parameter name "'+e+'" is not allowed')}lt(t,e);t.prototype.children=["name","value"];t.prototype.compile=function(e){return this.name.compile(e,E)};t.prototype.asReference=function(e){var t;if(this.reference)return this.reference;t=this.name;if(t["this"]){t=t.properties[0].name;t.value.reserved&&(t=new N(e.scope.freeVariable(t.value)))}else t.isComplex()&&(t=new N(e.scope.freeVariable("arg")));t=new $(t);this.splat&&(t=new q(t));return this.reference=t};t.prototype.isComplex=function(){return this.name.isComplex()};t.prototype.names=function(e){var t,r,i,s,o,u;e==null&&(e=this.name);t=function(e){var t;t=e.properties[0].name.value;return t.reserved?[]:[t]};if(e instanceof N)return[e.value];if(e instanceof $)return t(e);r=[];u=e.objects;for(s=0,o=u.length;s<o;s++){i=u[s];if(i instanceof n)r.push(i.value.unwrap().value);else if(i instanceof q)r.push(i.name.unwrap().value);else{if(!(i instanceof $))throw SyntaxError("illegal parameter "+i.compile());i.isArray()||i.isObject()?r.push.apply(r,this.names(i.base)):i["this"]?r.push.apply(r,t(i)):r.push(i.base.value)}}return r};return t}(r);exports.Splat=q=function(e){function t(e){this.name=e.compile?e:new N(e)}lt(t,e);t.prototype.children=["name"];t.prototype.isAssignable=K;t.prototype.assigns=function(e){return this.name.assigns(e)};t.prototype.compile=function(e){return this.index!=null?this.compileParam(e):this.name.compile(e)};t.prototype.unwrap=function(){return this.name};t.compileSplattedArray=function(e,n,r){var i,s,o,u,a,f,l,c;a=-1;while((f=n[++a])&&!(f instanceof t))continue;if(a>=n.length)return"";if(n.length===1){o=n[0].compile(e,E);return r?o:""+ot("slice")+".call("+o+")"}i=n.slice(a);for(u=l=0,c=i.length;l<c;u=++l){f=i[u];o=f.compile(e,E);i[u]=f instanceof t?""+ot("slice")+".call("+o+")":"["+o+"]"}if(a===0)return i[0]+(".concat("+i.slice(1).join(", ")+")");s=function(){var t,r,i,s;i=n.slice(0,a);s=[];for(t=0,r=i.length;t<r;t++){f=i[t];s.push(f.compile(e,E))}return s}();return"["+s.join(", ")+"].concat("+i.join(", ")+")"};return t}(r);exports.While=J=function(e){function t(e,t){this.condition=(t!=null?t.invert:void 0)?e.invert():e;this.guard=t!=null?t.guard:void 0}lt(t,e);t.prototype.children=["condition","guard","body"];t.prototype.isStatement=K;t.prototype.makeReturn=function(e){if(e)return t.__super__.makeReturn.apply(this,arguments);this.returns=!this.jumps({loop:!0});return this};t.prototype.addBody=function(e){this.body=e;return this};t.prototype.jumps=function(){var e,t,n,r;e=this.body.expressions;if(!e.length)return!1;for(n=0,r=e.length;n<r;n++){t=e[n];if(t.jumps({loop:!0}))return t}return!1};t.prototype.compileNode=function(e){var t,n,r,s;e.indent+=U;s="";t=this.body;if(t.isEmpty())t="";else{if(this.returns){t.makeReturn(r=e.scope.freeVariable("results"));s=""+this.tab+r+" = [];\n"}this.guard&&(t.expressions.length>1?t.expressions.unshift(new m(
(new _(this.guard)).invert(),new N("continue"))):this.guard&&(t=i.wrap([new m(this.guard,t)])));t="\n"+t.compile(e,T)+"\n"+this.tab}n=s+this.tab+("while ("+this.condition.compile(e,x)+") {"+t+"}");this.returns&&(n+="\n"+this.tab+"return "+r+";");return n};return t}(r);exports.Op=O=function(e){function i(e,n,r,i){if(e==="in")return new g(n,r);if(e==="do")return this.generateDo(n);if(e==="new"){if(n instanceof s&&!n["do"]&&!n.isNew)return n.newInstance();if(n instanceof a&&n.bound||n["do"])n=new _(n)}this.operator=t[e]||e;this.first=n;this.second=r;this.flip=!!i;return this}var t,r;lt(i,e);t={"==":"===","!=":"!==",of:"in"};r={"!==":"===","===":"!=="};i.prototype.children=["first","second"];i.prototype.isSimpleNumber=L;i.prototype.isUnary=function(){return!this.second};i.prototype.isComplex=function(){var e;return!this.isUnary()||(e=this.operator)!=="+"&&e!=="-"||this.first.isComplex()};i.prototype.isChainable=function(){var e;return(e=this.operator)==="<"||e===">"||e===">="||e==="<="||e==="==="||e==="!=="};i.prototype.invert=function(){var e,t,n,s,o;if(this.isChainable()&&this.first.isChainable()){e=!0;t=this;while(t&&t.operator){e&&(e=t.operator in r);t=t.first}if(!e)return(new _(this)).invert();t=this;while(t&&t.operator){t.invert=!t.invert;t.operator=r[t.operator];t=t.first}return this}if(s=r[this.operator]){this.operator=s;this.first.unwrap()instanceof i&&this.first.invert();return this}return this.second?(new _(this)).invert():this.operator==="!"&&(n=this.first.unwrap())instanceof i&&((o=n.operator)==="!"||o==="in"||o==="instanceof")?n:new i("!",this)};i.prototype.unfoldSoak=function(e){var t;return((t=this.operator)==="++"||t==="--"||t==="delete")&&st(e,this,"first")};i.prototype.generateDo=function(e){var t,r,i,o,u,f,l,c;o=[];r=e instanceof n&&(u=e.value.unwrap())instanceof a?u:e;c=r.params||[];for(f=0,l=c.length;f<l;f++){i=c[f];if(i.value){o.push(i.value);delete i.value}else o.push(i)}t=new s(e,o);t["do"]=!0;return t};i.prototype.compileNode=function(e){var t,n,r,i;n=this.isChainable()&&this.first.isChainable();n||(this.first.front=this.front);if(this.operator==="delete"&&e.scope.check(this.first.unwrapAll().value))throw SyntaxError("delete operand may not be argument or var");if(((r=this.operator)==="--"||r==="++")&&(i=this.first.unwrapAll().value,ct.call(j,i)>=0))throw SyntaxError("prefix increment/decrement may not have eval or arguments operand");if(this.isUnary())return this.compileUnary(e);if(n)return this.compileChain(e);if(this.operator==="?")return this.compileExistence(e);t=this.first.compile(e,S)+" "+this.operator+" "+this.second.compile(e,S);return e.level<=S?t:"("+t+")"};i.prototype.compileChain=function(e){var t,n,r,i;i=this.first.second.cache(e),this.first.second=i[0],r=i[1];n=this.first.compile(e,S);t=""+n+" "+(this.invert?"&&":"||")+" "+r.compile(e)+" "+this.operator+" "+this.second.compile(e,S);return"("+t+")"};i.prototype.compileExistence=function(e){var t,r;if(this.first.isComplex()){r=new N(e.scope.freeVariable("ref"));t=new _(new n(r,this.first))}else{t=this.first;r=t}return(new m(new l(t),r,{type:"if"})).addElse(this.second).compile(e)};i.prototype.compileUnary=function(e){var t,n,r;if(e.level>=b)return(new _(this)).compile(e);n=[t=this.operator];r=t==="+"||t==="-";(t==="new"||t==="typeof"||t==="delete"||r&&this.first instanceof i&&this.first.operator===t)&&n.push(" ");if(r&&this.first instanceof i||t==="new"&&this.first.isStatement(e))this.first=new _(this.first);n.push(this.first.compile(e,S));this.flip&&n.reverse();return n.join("")};i.prototype.toString=function(e){return i.__super__.toString.call(this,e,this.constructor.name+" "+this.operator)};return i}(r);exports.In=g=function(e){function t(e,t){this.object=e;this.array=t}lt(t,e);t.prototype.children=["object","array"];t.prototype.invert=k;t.prototype.compileNode=function(e){var t,n,r,i,s;if(this.array instanceof $&&this.array.isArray()){s=this.array.base.objects;for(r=0,i=s.length;r<i;r++){n=s[r];if(n instanceof q){t=!0;break}continue}if(!t)return this.compileOrTest(e)}return this.compileLoopTest(e)};t.prototype.compileOrTest=function(e){var t,n,r,i,s,o,u,a,f;if(this.array.base.objects.length===0)return""+!!this.negated;a=this.object.cache(e,S),o=a[0],s=a[1];f=this.negated?[" !== "," && "]:[" === "," || "],t=f[0],n=f[1];u=function(){var n,u,a,f;a=this.array.base.objects;f=[];for(r=n=0,u=a.length;n<u;r=++n){i=a[r];f.push((r?s:o)+t+i.compile(e,b))}return f}.call(this);u=u.join(n);return e.level<S?u:"("+u+")"};t.prototype.compileLoopTest=function(e){var t,n,r,i;i=this.object.cache(e,E),r=i[0],n=i[1];t=ot("indexOf")+(".call("+this.array.compile(e,E)+", "+n+") ")+(this.negated?"< 0":">= 0");if(r===n)return t;t=r+", "+t;return e.level<E?t:"("+t+")"};t.prototype.toString=function(e){return t.__super__.toString.call(this,e,this.constructor.name+(this.negated?"!":""))};return t}(r);exports.Try=X=function(e){function t(e,t,n,r){this.attempt=e;this.error=t;this.recovery=n;this.ensure=r}lt(t,e);t.prototype.children=["attempt","recovery","ensure"];t.prototype.isStatement=K;t.prototype.jumps=function(e){var t;return this.attempt.jumps(e)||((t=this.recovery)!=null?t.jumps(e):void 0)};t.prototype.makeReturn=function(e){this.attempt&&(this.attempt=this.attempt.makeReturn(e));this.recovery&&(this.recovery=this.recovery.makeReturn(e));return this};t.prototype.compileNode=function(e){var t,n,r,i;e.indent+=U;r=this.error?" ("+this.error.compile(e)+") ":" ";i=this.attempt.compile(e,T);t=function(){var t;if(this.recovery){if(t=this.error.value,ct.call(j,t)>=0)throw SyntaxError('catch variable may not be "'+this.error.value+'"');e.scope.check(this.error.value)||e.scope.add(this.error.value,"param");return" catch"+r+"{\n"+this.recovery.compile(e,T)+"\n"+this.tab+"}"}if(!this.ensure&&!this.recovery)return" catch (_error) {}"}.call(this);n=this.ensure?" finally {\n"+this.ensure.compile(e,T)+"\n"+this.tab+"}":"";return""+this.tab+"try {\n"+i+"\n"+this.tab+"}"+(t||"")+n};return t}(r);exports.Throw=W=function(e){function t(e){this.expression=e}lt(t,e);t.prototype.children=["expression"];t.prototype.isStatement=K;t.prototype.jumps=L;t.prototype.makeReturn=z;t.prototype.compileNode=function(e){return this.tab+("throw "+this.expression.compile(e)+";")};return t}(r);exports.Existence=l=function(e){function t(e){this.expression=e}lt(t,e);t.prototype.children=["expression"];t.prototype.invert=k;t.prototype.compileNode=function(e){var t,n,r,i;this.expression.front=this.front;r=this.expression.compile(e,S);if(p.test(r)&&!e.scope.check(r)){i=this.negated?["===","||"]:["!==","&&"],t=i[0],n=i[1];r="typeof "+r+" "+t+' "undefined" '+n+" "+r+" "+t+" null"}else r=""+r+" "+(this.negated?"==":"!=")+" null";return e.level<=w?r:"("+r+")"};return t}(r);exports.Parens=_=function(e){function t(e){this.body=e}lt(t,e);t.prototype.children=["body"];t.prototype.unwrap=function(){return this.body};t.prototype.isComplex=function(){return this.body.isComplex()};t.prototype.compileNode=function(e){var t,n,r;r=this.body.unwrap();if(r instanceof $&&r.isAtomic()){r.front=this.front;return r.compile(e)}n=r.compile(e,x);t=e.level<S&&(r instanceof O||r instanceof s||r instanceof h&&r.returns);return t?n:"("+n+")"};return t}(r);exports.For=h=function(e){function t(e,t){var n;this.source=t.source,this.guard=t.guard,this.step=t.step,this.name=t.name,this.index=t.index;this.body=i.wrap([e]);this.own=!!t.own;this.object=!!t.object;this.object&&(n=[this.index,this.name],this.name=n[0],this.index=n[1]);if(this.index instanceof $)throw SyntaxError("index cannot be a pattern matching expression");this.range=this.source instanceof $&&this.source.base instanceof P&&!this.source.properties.length;this.pattern=this.name instanceof $;if(this.range&&this.index)throw SyntaxError("indexes do not apply to range loops");if(this.range&&this.pattern)throw SyntaxError("cannot pattern match over range loops");this.returns=!1}lt(t,e);t.prototype.children=["body","source","guard","step"];t.prototype.compileNode=function(e){var t,r,s,o,u,a,f,l,c,h,d,v,g,y,b,w,x,C,k,L,A,O,M,D,P;t=i.wrap([this.body]);d=(P=tt(t.expressions))!=null?P.jumps():void 0;d&&d instanceof H&&(this.returns=!1);L=this.range?this.source.base:this.source;k=e.scope;g=this.name&&this.name.compile(e,E);f=this.index&&this.index.compile(e,E);g&&!this.pattern&&k.find(g);f&&k.find(f);this.returns&&(C=k.freeVariable("results"));l=this.object&&f||k.freeVariable("i");c=this.range&&g||f||l;h=c!==l?""+c+" = ":"";this.step&&!this.range&&(O=k.freeVariable("step"));this.pattern&&(g=l);D="";u="";r="";a=this.tab+U;if(this.range)s=L.compile(nt(e,{index:l,name:g,step:this.step}));else{M=this.source.compile(e,E);if((g||this.own)&&!p.test(M)){r=""+this.tab+(b=k.freeVariable("ref"))+" = "+M+";\n";M=b}g&&!this.pattern&&(y=""+g+" = "+M+"["+c+"]");if(!this.object){v=k.freeVariable("len");o=""+h+l+" = 0, "+v+" = "+M+".length";this.step&&(o+=", "+O+" = "+this.step.compile(e,S));A=""+h+(this.step?""+l+" += "+O:c!==l?"++"+l:""+l+"++");s=""+o+"; "+l+" < "+v+"; "+A}}if(this.returns){w=""+this.tab+C+" = [];\n";x="\n"+this.tab+"return "+C+";";t.makeReturn(C)}this.guard&&(t.expressions.length>1?t.expressions.unshift(new m((new _(this.guard)).invert(),new N("continue"))):this.guard&&(t=i.wrap([new m(this.guard,t)])));this.pattern&&t.expressions.unshift(new n(this.name,new N(""+M+"["+c+"]")));r+=this.pluckDirectCall(e,t);y&&(D="\n"+a+y+";");if(this.object){s=""+c+" in "+M;this.own&&(u="\n"+a+"if (!"+ot("hasProp")+".call("+M+", "+c+")) continue;")}t=t.compile(nt(e,{indent:a}),T);t&&(t="\n"+t+"\n");return""+r+(w||"")+this.tab+"for ("+s+") {"+u+D+t+this.tab+"}"+(x||"")};t.prototype.pluckDirectCall=function(e,t){var r,i,o,u,f,l,c,h,p,d,v,m,g,y,b;i="";d=t.expressions;for(f=h=0,p=d.length;h<p;f=++h){o=d[f];o=o.unwrapAll();if(!(o instanceof s))continue;c=o.variable.unwrapAll();if(!(c instanceof a||c instanceof $&&((v=c.base)!=null?v.unwrapAll():void 0)instanceof a&&c.properties.length===1&&((m=(g=c.properties[0].name)!=null?g.value:void 0)==="call"||m==="apply")))continue;u=((y=c.base)!=null?y.unwrapAll():void 0)||c;l=new N(e.scope.freeVariable("fn"));r=new $(l);c.base&&(b=[r,c],c.base=b[0],r=b[1]);t.expressions[f]=new s(r,o.args);i+=this.tab+(new n(l,u)).compile(e,T)+";\n"}return i};return t}(J);exports.Switch=R=function(e){function t(e,t,n){this.subject=e;this.cases=t;this.otherwise=n}lt(t,e);t.prototype.children=["subject","cases","otherwise"];t.prototype.isStatement=K;t.prototype.jumps=function(e){var t,n,r,i,s,o,u;e==null&&(e={block:!0});s=this.cases;for(r=0,i=s.length;r<i;r++){o=s[r],n=o[0],t=o[1];if(t.jumps(e))return t}return(u=this.otherwise)!=null?u.jumps(e):void 0};t.prototype.makeReturn=function(e){var t,n,r,s,o;s=this.cases;for(n=0,r=s.length;n<r;n++){t=s[n];t[1].makeReturn(e)}e&&(this.otherwise||(this.otherwise=new i([new N("void 0")])));(o=this.otherwise)!=null&&o.makeReturn(e);return this};t.prototype.compileNode=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;a=e.indent+U;f=e.indent=a+U;r=this.tab+("switch ("+(((d=this.subject)!=null?d.compile(e,x):void 0)||!1)+") {\n");v=this.cases;for(u=l=0,h=v.length;l<h;u=++l){m=v[u],s=m[0],t=m[1];g=et([s]);for(c=0,p=g.length;c<p;c++){i=g[c];this.subject||(i=i.invert());r+=a+("case "+i.compile(e,x)+":\n")}if(n=t.compile(e,T))r+=n+"\n";if(u===this.cases.length-1&&!this.otherwise)break;o=this.lastNonComment(t.expressions);if(o instanceof H||o instanceof N&&o.jumps()&&o.value!=="debugger")continue;r+=f+"break;\n"}this.otherwise&&this.otherwise.expressions.length&&(r+=a+("default:\n"+this.otherwise.compile(e,T)+"\n"));return r+this.tab+"}"};return t}(r);exports.If=m=function(e){function t(e,t,n){this.body=t;n==null&&(n={});this.condition=n.type==="unless"?e.invert():e;this.elseBody=null;this.isChain=!1;this.soak=n.soak}lt(t,e);t.prototype.children=["condition","body","elseBody"];t.prototype.bodyNode=function(){var e;return(e=this.body)!=null?e.unwrap():void 0};t.prototype.elseBodyNode=function(){var e;return(e=this.elseBody)!=null?e.unwrap():void 0};t.prototype.addElse=function(e){if(this.isChain)this.elseBodyNode().addElse(e);else{this.isChain=e instanceof t;this.elseBody=this.ensureBlock(e)}return this};t.prototype.isStatement=function(e){var t;return(e!=null?e.level:void 0)===T||this.bodyNode().isStatement(e)||((t=this.elseBodyNode())!=null?t.isStatement(e):void 0)};t.prototype.jumps=function(e){var t;return this.body.jumps(e)||((t=this.elseBody)!=null?t.jumps(e):void 0)};t.prototype.compileNode=function(e){return this.isStatement(e)?this.compileStatement(e):this.compileExpression(e)};t.prototype.makeReturn=function(e){e&&(this.elseBody||(this.elseBody=new i([new N("void 0")])));this.body&&(this.body=new i([this.body.makeReturn(e)]));this.elseBody&&(this.elseBody=new i([this.elseBody.makeReturn(e)]));return this};t.prototype.ensureBlock=function(e){return e instanceof i?e:new i([e])};t.prototype.compileStatement=function(e){var n,r,i,s,o;r=G(e,"chainChild");s=G(e,"isExistentialEquals");if(s)return(new t(this.condition.invert(),this.elseBodyNode(),{type:"if"})).compile(e);i=this.condition.compile(e,x);e.indent+=U;n=this.ensureBlock(this.body);o="if ("+i+") {\n"+n.compile(e)+"\n"+this.tab+"}";r||(o=this.tab+o);return this.elseBody?o+" else "+(this.isChain?(e.indent=this.tab,e.chainChild=!0,this.elseBody.unwrap().compile(e,T)):"{\n"+this.elseBody.compile(e,T)+"\n"+this.tab+"}"):o};t.prototype.compileExpression=function(e){var t,n,r,i;i=this.condition.compile(e,w);n=this.bodyNode().compile(e,E);t=this.elseBodyNode()?this.elseBodyNode().compile(e,E):"void 0";r=""+i+" ? "+n+" : "+t;return e.level>=w?"("+r+")":r};t.prototype.unfoldSoak=function(){return this.soak&&this};return t}(r);u={wrap:function(t,n,r){var o,u,f,l,c;if(t.jumps())return t;f=new a([],i.wrap([t]));o=[];if((l=t.contains(this.literalArgs))||t.contains(this.literalThis)){c=new N(l?"apply":"call");o=[new N("this")];l&&o.push(new N("arguments"));f=new $(f,[new e(c)])}f.noReturn=r;u=new s(f,o);return n?i.wrap([u]):u},literalArgs:function(e){return e instanceof N&&e.value==="arguments"&&!e.asKey},literalThis:function(e){return e instanceof N&&e.value==="this"&&!e.asKey||e instanceof a&&e.bound||e instanceof s&&e.isSuper}};st=function(e,t,n){var r;if(!(r=t[n].unfoldSoak(e)))return;t[n]=r.body;r.body=new $(t);return r};V={"extends":function(){return"function(child, parent) { for (var key in parent) { if ("+ot("hasProp")+".call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; }"},bind:function(){return"function(fn, me){ return function(){ return fn.apply(me, arguments); }; }"},indexOf:function(){return"[].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; }"},hasProp:function(){return"{}.hasOwnProperty"},slice:function(){return"[].slice"}};T=1;x=2;E=3;w=4;S=5;b=6;U="  ";d="[$A-Za-z_\\x7f-\\uffff][$\\w\\x7f-\\uffff]*";p=RegExp("^"+d+"$");B=/^[+-]?\d+$/;C=RegExp("^(?:("+d+")\\.prototype(?:\\.("+d+")|\\[(\"(?:[^\\\\\"\\r\\n]|\\\\.)*\"|'(?:[^\\\\'\\r\\n]|\\\\.)*')\\]|\\[(0x[\\da-fA-F]+|\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\]))|("+d+")$");v=/^['"]/;ot=function(e){var t;t="__"+e;F.root.assign(t,V[e]());return t};rt=function(e,t){e=e.replace(/\n/g,"$&"+t);return e.replace(/\s+$/,"")}}).call(this);