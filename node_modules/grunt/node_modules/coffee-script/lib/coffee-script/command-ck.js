// Generated by CoffeeScript 1.3.3
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q;c=require("fs");x=require("path");h=require("./helpers");b=require("./optparse");t=require("./coffee-script");q=require("child_process"),O=q.spawn,f=q.exec;n=require("events").EventEmitter;h.extend(t,new n);T=function(e){return process.stdout.write(e+"\n")};C=function(e){return process.stderr.write(e+"\n")};p=function(e){return/^\.|~$/.test(e)};e="Usage: coffee [options] path/to/script.coffee -- [args]\n\nIf called without options, `coffee` will run your script.";r=[["-b","--bare","compile without a top-level function wrapper"],["-c","--compile","compile to JavaScript and save as .js files"],["-e","--eval","pass a string from the command line as input"],["-h","--help","display this help message"],["-i","--interactive","run an interactive CoffeeScript REPL"],["-j","--join [FILE]","concatenate the source CoffeeScript before compiling"],["-l","--lint","pipe the compiled JavaScript through JavaScript Lint"],["-n","--nodes","print out the parse tree that the parser produces"],["--nodejs [ARGS]",'pass options directly to the "node" binary'],["-o","--output [DIR]","set the output directory for compiled JavaScript"],["-p","--print","print out the compiled JavaScript"],["-r","--require [FILE*]","require a library before executing your script"],["-s","--stdio","listen for and compile scripts over stdio"],["-t","--tokens","print out the tokens that the lexer/rewriter produce"],["-v","--version","display the version number"],["-w","--watch","watch scripts for changes and rerun commands"]];w={};A=[];L=[];g={};F={};y=null;exports.run=function(){var e,t,n,r,i;S();if(w.nodejs)return l();if(w.help)return D();if(w.version)return P();w.require&&m();if(w.interactive)return require("./repl");if(w.watch&&!c.watch)return C("The --watch feature depends on Node v0.6.0+. You are running "+process.version+".");if(w.stdio)return a();if(w.eval)return u(null,A[0]);if(!A.length)return require("./repl");e=w.run?A.splice(1):[];process.argv=process.argv.slice(0,2).concat(e);process.argv[0]="coffee";process.execPath=require.main.filename;i=[];for(n=0,r=A.length;n<r;n++){t=A[n];i.push(o(t,!0,x.normalize(t)))}return i};o=function(e,t,n){return c.stat(e,function(r,i){if(r&&r.code!=="ENOENT")throw r;if((r!=null?r.code:void 0)==="ENOENT"){if(t&&e.slice(-7)!==".coffee"){e=A[A.indexOf(e)]=""+e+".coffee";return o(e,t,n)}if(t){console.error("File not found: "+e);process.exit(1)}return}if(i.isDirectory()){w.watch&&j(e,n);return c.readdir(e,function(t,r){var i,s,u,a;if(t&&t.code!=="ENOENT")throw t;if((t!=null?t.code:void 0)==="ENOENT")return;s=A.indexOf(e);r=r.filter(function(e){return!p(e)});[].splice.apply(A,[s,s-s+1].concat(u=function(){var t,n,s;s=[];for(t=0,n=r.length;t<n;t++){i=r[t];s.push(x.join(e,i))}return s}())),u;[].splice.apply(L,[s,s-s+1].concat(a=r.map(function(){return null}))),a;return r.forEach(function(t){return o(x.join(e,t),!1,n)})})}if(t||x.extname(e)===".coffee"){w.watch&&B(e,n);return c.readFile(e,function(t,r){if(t&&t.code!=="ENOENT")throw t;if((t!=null?t.code:void 0)==="ENOENT")return;return u(e,r.toString(),n)})}g[e]=!0;return k(e,n)})};u=function(e,n,r){var o,u,a,f;o=w;u=s(e);try{a=f={file:e,input:n,options:u};t.emit("compile",f);if(o.tokens)return N(t.tokens(a.input));if(o.nodes)return T(t.nodes(a.input).toString().trim());if(o.run)return t.run(a.input,a.options);if(o.join&&a.file!==o.join){L[A.indexOf(a.file)]=a.input;return i()}a.output=t.compile(a.input,a.options);t.emit("success",f);if(o.print)return T(a.output.trim());if(o.compile)return I(a.file,a.output,r);if(o.lint)return v(a.file,a.output)}catch(l){t.emit("failure",l,f);if(t.listeners("failure").length)return;if(o.watch)return T(l.message+"");C(l instanceof Error&&l.stack||"ERROR: "+l);return process.exit(1)}};a=function(){var e,t;e="";t=process.openStdin();t.on("data",function(t){if(t)return e+=t.toString()});return t.on("end",function(){return u(null,e)})};d=null;i=function(){if(!w.join)return;if(!L.some(function(e){return e===null})){clearTimeout(d);return d=H(100,function(){return u(w.join,L.join("\n"),w.join)})}};m=function(){var e,t,n,r,i;e=module.filename;module.filename=".";i=w.require;for(n=0,r=i.length;n<r;n++){t=i[n];require(t)}return module.filename=e};B=function(e,t){var n,r,s,o,a,f;s=null;r=null;a=function(r){if(r.code!=="ENOENT")throw r;if(A.indexOf(e)===-1)return;try{o();return n()}catch(r){k(e,t,!0);return i()}};n=function(){clearTimeout(r);return r=H(25,function(){return c.stat(e,function(n,r){if(n)return a(n);if(s&&r.size===s.size&&r.mtime.getTime()===s.mtime.getTime())return o();s=r;return c.readFile(e,function(n,r){if(n)return a(n);u(e,r.toString(),t);return o()})})})};try{f=c.watch(e,n)}catch(l){a(l)}return o=function(){f!=null&&f.close();return f=c.watch(e,n)}};j=function(e,t){var n,r;n=null;try{return r=c.watch(e,function(){clearTimeout(n);return n=H(25,function(){return c.readdir(e,function(n,i){var s,u,a,f;if(n){if(n.code!=="ENOENT")throw n;r.close();return _(e,t)}f=[];for(u=0,a=i.length;u<a;u++){s=i[u];if(!!p(s)||!!g[s])continue;s=x.join(e,s);if(A.some(function(e){return e.indexOf(s)>=0}))continue;A.push(s);L.push(null);f.push(o(s,!1,t))}return f})})})}catch(i){if(i.code!=="ENOENT")throw i}};_=function(e,t){var n,r,s,o,u;r=A.slice(0);s=function(){var t,r,i;i=[];for(t=0,r=A.length;t<r;t++){n=A[t];n.indexOf(e)>=0&&i.push(n)}return i}();for(o=0,u=s.length;o<u;o++){n=s[o];k(n,t,!0)}if(!A.some(function(e,t){return r[t]!==e}))return;return i()};k=function(e,t,n){var r,i;r=A.indexOf(e);A.splice(r,1);L.splice(r,1);if(n&&!w.join){i=E(e,t);return x.exists(i,function(t){if(t)return c.unlink(i,function(t){if(t&&t.code!=="ENOENT")throw t;return M("removed "+e)})})}};E=function(e,t){var n,r,i,s;i=x.basename(e,x.extname(e))+".js";s=x.dirname(e);n=t==="."?s:s.substring(t.length);r=w.output?x.join(w.output,n):s;return x.join(r,i)};I=function(e,t,n){var r,i,s;s=E(e,n);i=x.dirname(s);r=function(){t.length<=0&&(t=" ");return c.writeFile(s,t,function(t){if(t)return T(t.message);if(w.compile&&w.watch)return M("compiled "+e)})};return x.exists(i,function(e){return e?r():f("mkdir -p "+i,r)})};H=function(e,t){return setTimeout(t,e)};M=function(e){return console.log(""+(new Date).toLocaleTimeString()+" - "+e)};v=function(e,t){var n,r,i;i=function(t){return T(e+":	"+t.toString().trim())};n=__dirname+"/../../extras/jsl.conf";r=O("jsl",["-nologo","-stdin","-conf",n]);r.stdout.on("data",i);r.stderr.on("data",i);r.stdin.write(t);return r.stdin.end()};N=function(e){var t,n,r,i;t=function(){var t,s,o,u;u=[];for(t=0,s=e.length;t<s;t++){r=e[t];o=[r[0],r[1].toString().replace(/\n/,"\\n")],n=o[0],i=o[1];u.push("["+n+" "+i+"]")}return u}();return T(t.join(" "))};S=function(){var t,n,i,s,o;y=new b.OptionParser(r,e);n=w=y.parse(process.argv.slice(2));n.compile||(n.compile=!!n.output);n.run=!(n.compile||n.print||n.lint);n.print=!!(n.print||n.eval||n.stdio&&n.compile);A=n.arguments;for(t=s=0,o=A.length;s<o;t=++s){i=A[t];L[t]=null}};s=function(e){return{filename:e,bare:w.bare,header:w.compile}};l=function(){var e,t;t=w.nodejs.split(/\s+/);e=process.argv.slice(1);e.splice(e.indexOf("--nodejs"),2);return O(process.execPath,t.concat(e),{cwd:process.cwd(),env:process.env,customFds:[0,1,2]})};D=function(){return T((new b.OptionParser(r,e)).help())};P=function(){return T("CoffeeScript version "+t.VERSION)}}).call(this);