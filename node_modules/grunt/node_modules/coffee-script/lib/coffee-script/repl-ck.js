// Generated by CoffeeScript 1.3.3
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;E=process.openStdin();S=process.stdout;t=require("./coffee-script");y=require("readline");v=require("util").inspect;u=require("vm").Script;n=require("module");r="coffee> ";s="------> ";i="......> ";h=!1;process.platform!=="win32"&&(h=!process.env.NODE_DISABLE_COLORS);p=function(e){return S.write((e.stack||e.toString())+"\n")};e=/\s*([\w\.]+)(?:\.(\w*))$/;o=/(\w+)$/i;a=function(e){return l(e)||c(e)||[[],e]};l=function(t){var n,r,i,s,o,a,f,l;if(s=t.match(e)){n=s[0],o=s[1],f=s[2];try{l=u.runInThisContext(o)}catch(c){return}l=Object(l);a=Object.getOwnPropertyNames(l);for(i in l)~a.indexOf(l)&&a.push(i);r=d(f,a);return[r,f]}};c=function(e){var n,r,i,s,a,f,l;r=(l=e.match(o))!=null?l[1]:void 0;e===""&&(r="");if(r!=null){f=u.runInThisContext("Object.getOwnPropertyNames(Object(this))");i=function(){var e,n,r,i;r=t.RESERVED;i=[];for(e=0,n=r.length;e<n;e++){a=r[e];a.slice(0,2)!=="__"&&i.push(a)}return i}();s=f.concat(i);n=d(r,s);return[n,r]}};d=function(e,t){var n,r,i,s;s=[];for(r=0,i=t.length;r<i;r++){n=t[r];n.indexOf(e)===0&&s.push(n)}return s};process.on("uncaughtException",p);f="";w=function(e){var n,s,o;e=e.replace(/(^|[\r\n]+)(\s*)##?(?:[^#\r\n][^\r\n]*|)($|[\r\n])/,"$1$2$3");e=e.replace(/[\r\n]+$/,"");if(m){f+=""+e+"\n";b.setPrompt(i);b.prompt();return}if(!e.toString().trim()&&!f){b.prompt();return}n=f+=e;if(n[n.length-1]==="\\"){f=""+f.slice(0,-1)+"\n";b.setPrompt(i);b.prompt();return}b.setPrompt(r);f="";try{o=global._;s=t.eval("_=("+n+"\n)",{filename:"repl",modulename:"repl"});s===void 0&&(global._=o);b.output.write(""+v(s,!1,2,h)+"\n")}catch(u){p(u)}return b.prompt()};if(E.readable){g="";b={prompt:function(){return S.write(this._prompt)},setPrompt:function(e){return this._prompt=e},input:E,output:S,on:function(){}};E.on("data",function(e){var t,n,r,i,s;g+=e;if(!/\n/.test(g))return;n=g.split("\n");g=n[n.length-1];s=n.slice(0,-1);for(r=0,i=s.length;r<i;r++){t=s[r];if(!t)continue;S.write(""+t+"\n");w(t)}});E.on("end",function(){var e,t,n,r;r=g.trim().split("\n");for(t=0,n=r.length;t<n;t++){e=r[t];if(!e)continue;S.write(""+e+"\n");w(e)}S.write("\n");return process.exit(0)})}else if(y.createInterface.length<3){b=y.createInterface(E,a);E.on("data",function(e){return b.write(e)})}else b=y.createInterface(E,S,a);m=!1;b.input.on("keypress",function(e,t){var n,i;if(!(t&&t.ctrl&&!t.meta&&!t.shift&&t.name==="v"))return;n=b.cursor;b.output.cursorTo(0);b.output.clearLine(1);m=!m;!m&&f&&b._line();f="";b.setPrompt(i=m?s:r);b.prompt();return b.output.cursorTo(i.length+(b.cursor=n))});b.input.on("keypress",function(e,t){if(!m||!b.line)return;if(!(t&&t.ctrl&&!t.meta&&!t.shift&&t.name==="d"))return;m=!1;return b._line()});b.on("attemptClose",function(){if(m){m=!1;b.output.cursorTo(0);b.output.clearLine(1);b._onLine(b.line);return}if(f){f="";b.output.write("\n");b.setPrompt(r);return b.prompt()}return b.close()});b.on("close",function(){b.output.write("\n");return b.input.destroy()});b.on("line",w);b.setPrompt(r);b.prompt()}).call(this);