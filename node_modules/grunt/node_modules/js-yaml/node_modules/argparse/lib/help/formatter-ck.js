/**
 * class HelpFormatter
 *
 * Formatter for generating usage messages and argument help strings. Only the
 * name of this class is considered a public API. All the methods provided by
 * the class are considered an implementation detail.
 *
 * Do not call in your code, use this class only for inherits your own forvatter
 *
 * ToDo add [additonal formatters][1]
 *
 * [1]:http://docs.python.org/dev/library/argparse.html#formatter-class
 **/"use strict";function Section(e,t){this._parent=e;this._heading=t;this._items=[]}var _=require("underscore");_.str=require("underscore.string");var $$=require("../const");Section.prototype.addItem=function(e){this._items.push(e)};Section.prototype.formatHelp=function(e){var t,n;!this._parent||e._indent();t=this._items.map(function(t){var n,r,i;n=e;r=t[0];i=t[1];return r.apply(n,i)});t=e._joinParts(t);!this._parent||e._dedent();if(!t)return"";n="";if(!!this._heading&&this._heading!==$$.SUPPRESS){var r=e.currentIndent;n=_.str.repeat(" ",r)+this._heading+":"+$$.EOL}return e._joinParts([$$.EOL,n,t,$$.EOL])};var HelpFormatter=module.exports=function(t){t=t||{};this._prog=t.prog;this._maxHelpPosition=t.maxHelpPosition||24;this._width=t.width||(process.env.COLUMNS||80)-2;this._currentIndent=0;this._indentIncriment=t.indentIncriment||2;this._level=0;this._actionMaxLength=0;this._rootSection=new Section(null);this._currentSection=this._rootSection;this._whitespaceMatcher=new RegExp("\\s+","g");this._longBreakMatcher=new RegExp($$.EOL+$$.EOL+$$.EOL+"+","g")};HelpFormatter.prototype._indent=function(){this._currentIndent+=this._indentIncriment;this._level+=1};HelpFormatter.prototype._dedent=function(){this._currentIndent-=this._indentIncriment;this._level-=1;if(this._currentIndent<0)throw new Error("Indent decreased below 0.")};HelpFormatter.prototype._addItem=function(e,t){this._currentSection.addItem([e,t])};HelpFormatter.prototype.startSection=function(e){this._indent();var t=new Section(this._currentSection,e),n=t.formatHelp.bind(t);this._addItem(n,[this]);this._currentSection=t};HelpFormatter.prototype.endSection=function(){this._currentSection=this._currentSection._parent;this._dedent()};HelpFormatter.prototype.addText=function(e){!!e&&e!==$$.SUPPRESS&&this._addItem(this._formatText,[e])};HelpFormatter.prototype.addUsage=function(e,t,n,r){e!==$$.SUPPRESS&&this._addItem(this._formatUsage,[e,t,n,r])};HelpFormatter.prototype.addArgument=function(e){if(e.help!==$$.SUPPRESS){var t=this,n=[this._formatActionInvocation(e)],r=n[0].length,i;if(!!e._getSubactions){this._indent();e._getSubactions().forEach(function(e){var i=t._formatActionInvocation(e);n.push(i);r=Math.max(r,i.length)});this._dedent()}i=r+this._currentIndent;this._actionMaxLength=Math.max(this._actionMaxLength,i);this._addItem(this._formatAction,[e])}};HelpFormatter.prototype.addArguments=function(e){var t=this;e.forEach(function(e){t.addArgument(e)})};HelpFormatter.prototype.formatHelp=function(){var e=this._rootSection.formatHelp(this);if(e){e=e.replace(this._longBreakMatcher,$$.EOL+$$.EOL);e=_.str.strip(e,$$.EOL)+$$.EOL}return e};HelpFormatter.prototype._joinParts=function(e){return e.filter(function(e){return!!e&&e!==$$.SUPPRESS}).join("")};HelpFormatter.prototype._formatUsage=function(e,t,n,r){!r&&!_.isString(r)&&(r="usage: ");t=t||[];n=n||[];if(e)e=_.str.sprintf(e,{prog:this._prog});else if(!e&&t.length===0)e=this._prog;else if(!e){var i=this._prog,s=[],o=[],u,a;t.forEach(function(e){e.isOptional()?s.push(e):o.push(e)});u=this._formatActionsUsage([].concat(s,o),n);e=[i,u].join(" ");a=this._width-this._currentIndent;if(r.length+e.length>a){var f=new RegExp("\\(.*?\\)+|\\[.*?\\]+|\\S+","g"),l=this._formatActionsUsage(s,n),c=this._formatActionsUsage(o,n),h=l.match(f),p=c.match(f)||[];if(h.join(" ")!==l)throw new Error("assert \"optionalParts.join(' ') === optionalUsage\"");if(p.join(" ")!==c)throw new Error("assert \"positionalParts.join(' ') === positionalUsage\"");var d=function(e,t,n){var r=[],i=[],s=n?n.length-1:t.length-1;e.forEach(function(e){if(s+1+e.length>a){r.push(t+i.join(" "));i=[];s=t.length-1}i.push(e);s+=e.length+1});i&&r.push(t+i.join(" "));n&&(r[0]=r[0].substr(t.length));return r},v,m,g;if(r.length+i.length<=.75*a){m=_.str.repeat(" ",r.length+i.length+1);h?v=[].concat(d([i].concat(h),m,r),d(p,m)):p?v=d([i].concat(p),m,r):v=[i]}else{m=_.str.repeat(" ",r.length);g=h+p;v=d(g,m);v.length>1&&(v=[].concat(d(h,m),d(p,m)));v=[i]+v}e=v.join($$.EOL)}}return r+e+$$.EOL+$$.EOL};HelpFormatter.prototype._formatActionsUsage=function(e,t){var n=[],r=[],i=this;t.forEach(function(t){var i,s,o=e.indexOf(t._groupActions[0]);if(o>=0){i=o+t._groupActions.length;if(_.isEqual(e.slice(o,i),t._groupActions)){t._groupActions.forEach(function(e){n.push(e)});if(!t.required){r[o]?r[o]+=" [":r[o]="[";r[i]="]"}else{r[o]?r[o]+=" (":r[o]="(";r[i]=")"}for(s=o+1;s<i;s+=1)r[s]="|"}}});var s=[];e.forEach(function(e,t){var o,u,a,f;if(e.help===$$.SUPPRESS){s.push(null);r[t]==="|"?r.splice(t,t):r[t+1]==="|"&&r.splice(t+1,t+1)}else if(!e.isOptional()){o=i._formatArgs(e,e.dest);n.indexOf(e)>=0&&o[0]==="["&&o[o.length-1]==="]"&&(o=o.slice(1,-1));s.push(o)}else{u=e.optionStrings[0];if(e.nargs===0)o=""+u;else{a=e.dest.toUpperCase();f=i._formatArgs(e,a);o=u+" "+f}!e.required&&n.indexOf(e)<0&&(o="["+o+"]");s.push(o)}});for(var o=r.length-1;o>=0;--o)r[o]!==null&&s.splice(o,0,r[o]);var u=s.filter(function(e){return!!e}).join(" ");u=u.replace(/([\[(]) /g,"$1");u=u.replace(/ ([\])])/g,"$1");u=u.replace(/\[ *\]/g,"");u=u.replace(/\( *\)/g,"");u=u.replace(/\(([^|]*)\)/g,"$1");u=_.str.strip(u);return u};HelpFormatter.prototype._formatText=function(e){e=_.str.sprintf(e,{prog:this._prog});var t=this._width-this._currentIndent,n=_.str.repeat(" ",this._currentIndent);return this._fillText(e,t,n)+$$.EOL+$$.EOL};HelpFormatter.prototype._formatAction=function(e){var t=this,n,r,i,s,o=Math.min(this._actionMaxLength+2,this._maxHelpPosition),u=this._width-o,a=o-this._currentIndent-2,f=this._formatActionInvocation(e);if(!e.help)f=_.str.repeat(" ",this._currentIndent)+f+$$.EOL;else if(f.length<=a){f=_.str.repeat(" ",this._currentIndent)+f+"  "+_.str.repeat(" ",a-f.length);s=0}else{f=_.str.repeat(" ",this._currentIndent)+f+$$.EOL;s=o}i=[f];if(!e.help)f.charAt(f.length-1)!==$$.EOL&&i.push($$.EOL);else{n=this._expandHelp(e);r=this._splitLines(n,u);i.push(_.str.repeat(" ",s)+r[0]+$$.EOL);r.slice(1).forEach(function(e){i.push(_.str.repeat(" ",o)+e+$$.EOL)})}if(!!e._getSubactions){this._indent();e._getSubactions().forEach(function(e){i.push(t._formatAction(e))});this._dedent()}return this._joinParts(i)};HelpFormatter.prototype._formatActionInvocation=function(e){if(!e.isOptional()){var t=this._metavarFormatter(e,e.dest),n=t(1);return n[0]}var r=[],i,s;if(e.nargs===0)r=r.concat(e.optionStrings);else{i=e.dest.toUpperCase();s=this._formatArgs(e,i);e.optionStrings.forEach(function(e){r.push(e+" "+s)})}return r.join(", ")};HelpFormatter.prototype._metavarFormatter=function(e,t){var n;if(!e.metavar&&e.metavar!=="")if(!e.choices)n=t;else{var r=e.choices;_.isString(r)?r=r.split("").join(", "):_.isArray(r)?r=r.join(","):r=_.keys(r).join(",");n="{"+r+"}"}else n=e.metavar;return function(e){if(Array.isArray(n))return n;var t=[];for(var r=0;r<e;r+=1)t.push(n);return t}};HelpFormatter.prototype._formatArgs=function(e,t){var n,r,i=this._metavarFormatter(e,t);switch(e.nargs){case undefined:case null:r=i(1);n=""+r[0];break;case $$.OPTIONAL:r=i(1);n="["+r[0]+"]";break;case $$.ZERO_OR_MORE:r=i(2);n="["+r[0]+" ["+r[1]+" ...]]";break;case $$.ONE_OR_MORE:r=i(2);n=""+r[0]+" ["+r[1]+" ...]";break;case $$.REMAINDER:n="...";break;case $$.PARSER:r=i(1);n=r[0]+" ...";break;default:r=i(e.nargs);n=r.join(" ")}return n};HelpFormatter.prototype._expandHelp=function(e){var t,n,r={prog:this._prog};for(t in e)if(e.hasOwnProperty(t)){n=e[t];n!==$$.SUPPRESS&&(r[t]=n)}!r.choices||(_.isString(r.choices)?r.choices=r.choices.split("").join(", "):_.isArray(r.choices)?r.choices=r.choices.join(", "):r.choices=_.keys(r.choices).join(", "));return _.str.sprintf(this._getHelpString(e),r)};HelpFormatter.prototype._splitLines=function(e,t){var n=[],r=[" ",".",",","!","?"],i=new RegExp("["+r.join("")+"][^"+r.join("")+"]*$");e=e.replace(/[\n\|\t]/g," ");e=_.str.strip(e);e=e.replace(this._whitespaceMatcher," ");e.split($$.EOL).forEach(function(e){if(t>=e.length){n.push(e);return}var s=0,o=t,u=0;while(o<=e.length){if(o!==e.length&&r.indexOf(e[o]<-1)){u=(i.exec(e.substring(s,o))||{}).index;o=s+u+1}n.push(e.substring(s,o));s=o;o+=t}s<e.length&&n.push(e.substring(s,o))});return n};HelpFormatter.prototype._fillText=function(e,t,n){var r=this._splitLines(e,t);r=r.map(function(e){return n+e});return r.join($$.EOL)};HelpFormatter.prototype._getHelpString=function(e){return e.help};