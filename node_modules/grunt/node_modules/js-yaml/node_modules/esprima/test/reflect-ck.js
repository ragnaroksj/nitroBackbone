// This is modified from Mozilla Reflect.parse test suite (the file is located
// at js/src/tests/js1_8_5/extensions/reflect-parse.js in the source tree).
//
// Some notable changes:
//   * Removed unsupported features (destructuring, let, comprehensions...).
//   * Removed tests for E4X (ECMAScript for XML).
//   * Removed everything related to builder.
//   * Enclosed every 'Pattern' construct with a scope.
//   * Tweaked some expected tree to remove generator field.
//   * Removed the test for bug 632030 and bug 632024.
/* -*- Mode: C++; tab-width: 8; indent-tabs-mode: nil; c-basic-offset: 4 -*- *//*
 * Any copyright is dedicated to the Public Domain.
 * http://creativecommons.org/licenses/publicdomain/
 */(function(e){function t(e,t){function n(e){return t({type:"Program",body:e})}function r(e){return t({type:"ExpressionStatement",expression:e})}function i(e){return t({type:"ThrowStatement",argument:e})}function s(e){return t({type:"ReturnStatement",argument:e})}function o(e){return t({type:"YieldExpression",argument:e})}function u(e){return t({type:"Literal",value:e})}function f(e,n,r){return t({type:"FunctionDeclaration",id:e,params:n,defaults:[],body:r,rest:null,generator:!1,expression:!1})}function l(e,n,r){return t({type:"FunctionDeclaration",id:e,params:n,defaults:[],body:r,rest:null,generator:!1,expression:!1})}function c(e,n){return t({type:"VariableDeclarator",id:e,init:n})}function h(e){return t({type:"VariableDeclaration",declarations:e,kind:"var"})}function p(e){return t({type:"VariableDeclaration",declarations:e,kind:"let"})}function d(e){return t({type:"VariableDeclaration",declarations:e,kind:"const"})}function v(e){return t({type:"Identifier",name:e})}function m(e,n){return t({type:"MemberExpression",computed:!1,object:e,property:n})}function g(e,n){return t({type:"MemberExpression",computed:!0,object:e,property:n})}function y(e,n,r,i){return t({type:"ForStatement",init:e,test:n,update:r,body:i})}function b(e,n,r){return t({type:"ForInStatement",left:e,right:n,body:r,each:!1})}function w(e,n,r){return t({type:"ForInStatement",left:e,right:n,body:r,each:!0})}function E(e){return t({type:"BreakStatement",label:e})}function S(e){return t({type:"ContinueStatement",label:e})}function x(e){return t({type:"BlockStatement",body:e})}function N(e,n,r){return t({type:"IfStatement",test:e,alternate:r,consequent:n})}function C(e,n){return t({type:"LabeledStatement",label:e,body:n})}function k(e,n){return t({type:"WithStatement",object:e,body:n})}function L(e,n){return t({type:"WhileStatement",test:e,body:n})}function A(e,n){return t({type:"DoWhileStatement",test:n,body:e})}function O(e,n){return t({type:"SwitchStatement",discriminant:e,cases:n})}function M(e,n){return t({type:"SwitchCase",test:e,consequent:n})}function _(e){return t({type:"SwitchCase",test:null,consequent:e})}function D(e,n,r){return n?t({type:"GuardedCatchClause",param:e,guard:n,body:r}):t({type:"CatchClause",param:e,body:r})}function P(e,n,r,i){return t({type:"TryStatement",block:e,guardedHandlers:n,handlers:r,finalizer:i})}function H(e,n){return t({type:"LetStatement",head:e,body:n})}function B(e,n,r,i){return t({type:"FunctionExpression",id:e,params:n,defaults:[],body:r,rest:null,generator:!1,expression:!1})}function j(e,n,r){return t({type:"FunctionExpression",id:e,params:n,defaults:[],body:r,rest:null,generator:!1,expression:!1})}function F(e,n){return t({type:"UnaryExpression",operator:e,argument:n,prefix:!0})}function I(e,n,r){return t({type:"BinaryExpression",operator:e,left:n,right:r})}function q(e,n,r){return t({type:"AssignmentExpression",operator:e,left:n,right:r})}function R(e,n,r){return t({type:"UpdateExpression",operator:e,argument:n,prefix:r})}function U(e,n,r){return t({type:"LogicalExpression",operator:e,left:n,right:r})}function z(e,n,r){return t({type:"ConditionalExpression",test:e,consequent:n,alternate:r})}function W(e){return t({type:"SequenceExpression",expressions:e})}function X(e,n){return t({type:"NewExpression",callee:e,arguments:n})}function V(e,n){return t({type:"CallExpression",callee:e,arguments:n})}function $(e){return t({type:"ArrayExpression",elements:e})}function J(e){return t({type:"ObjectExpression",properties:e})}function K(e,n,r){return t({type:"Property",key:e,value:n,kind:r})}function Q(e){return t({type:"ArrayPattern",elements:e})}function G(e){return t({type:"ObjectPattern",properties:e})}function Y(e){return"(function(){ "+e+" })"}function Z(e){return n([r(B(null,[],x([e])))])}function et(e){return"(function(){ { "+e+" } })"}function tt(e){return n([r(B(null,[],x([x([e])])))])}function nt(t,n){tt(n).assert(e.parse(et(t)))}function rt(e,t){nt(e,r(t))}function it(t,n,r){tt(n).assert(e.parse(et(t),{builder:r}))}function st(t,n){Z(n).assert(e.parse(Y(t)))}function ot(e,t){st(e,r(t))}function ut(t,n){Z(n).assert(e.parse(Y(t)))}function at(t,r,i){n([r]).assert(e.parse(t,{builder:i}))}function ft(t,i,s){n([r(i)]).assert(e.parse(t,{builder:s}))}function lt(t,r){n([r]).assert(e.parse(t))}function ct(t,r){n(r).assert(e.parse(t))}function ht(e,t){st(e,t);at(e,t);nt(e,t)}function pt(e,t){ot(e,t);ft(e,t);rt(e,t)}function dt(e,t){ut(e,t);lt(e,t);it(e,t)}function vt(t,n){try{e.parse(t)}catch(r){return}throw new Error("expected "+n.name+" for "+uneval(t))}var a=t({type:"ThisExpression"}),T=t({type:"EmptyStatement"});dt("var x = 1, y = 2, z = 3",h([c(v("x"),u(1)),c(v("y"),u(2)),c(v("z"),u(3))]));dt("var x, y, z",h([c(v("x"),null),c(v("y"),null),c(v("z"),null)]));dt("function foo() { }",f(v("foo"),[],x([])));dt("function foo() { return 42 }",f(v("foo"),[],x([s(u(42))])));dt("function f(a) { function a() { } }",f(v("f"),[v("a")],x([f(v("a"),[],x([]))])));dt("function f(a,b,c) { function b() { } }",f(v("f"),[v("a"),v("b"),v("c")],x([f(v("b"),[],x([]))])));pt("true",u(!0));pt("false",u(!1));pt("42",u(42));pt("(/asdf/)",u(/asdf/));pt("this",a);pt("foo",v("foo"));pt("foo.bar",m(v("foo"),v("bar")));pt("foo[bar]",g(v("foo"),v("bar")));pt("(function(){})",B(null,[],x([])));pt("(function f() {})",B(v("f"),[],x([])));pt("(function f(x,y,z) {})",B(v("f"),[v("x"),v("y"),v("z")],x([])));pt("(++x)",R("++",v("x"),!0));pt("(x++)",R("++",v("x"),!1));pt("(+x)",F("+",v("x")));pt("(-x)",F("-",v("x")));pt("(!x)",F("!",v("x")));pt("(~x)",F("~",v("x")));pt("(delete x)",F("delete",v("x")));pt("(typeof x)",F("typeof",v("x")));pt("(void x)",F("void",v("x")));pt("(x == y)",I("==",v("x"),v("y")));pt("(x != y)",I("!=",v("x"),v("y")));pt("(x === y)",I("===",v("x"),v("y")));pt("(x !== y)",I("!==",v("x"),v("y")));pt("(x < y)",I("<",v("x"),v("y")));pt("(x <= y)",I("<=",v("x"),v("y")));pt("(x > y)",I(">",v("x"),v("y")));pt("(x >= y)",I(">=",v("x"),v("y")));pt("(x << y)",I("<<",v("x"),v("y")));pt("(x >> y)",I(">>",v("x"),v("y")));pt("(x >>> y)",I(">>>",v("x"),v("y")));pt("(x + y)",I("+",v("x"),v("y")));pt("(w + x + y + z)",I("+",I("+",I("+",v("w"),v("x")),v("y")),v("z")));pt("(x - y)",I("-",v("x"),v("y")));pt("(w - x - y - z)",I("-",I("-",I("-",v("w"),v("x")),v("y")),v("z")));pt("(x * y)",I("*",v("x"),v("y")));pt("(x / y)",I("/",v("x"),v("y")));pt("(x % y)",I("%",v("x"),v("y")));pt("(x | y)",I("|",v("x"),v("y")));pt("(x ^ y)",I("^",v("x"),v("y")));pt("(x & y)",I("&",v("x"),v("y")));pt("(x in y)",I("in",v("x"),v("y")));pt("(x instanceof y)",I("instanceof",v("x"),v("y")));pt("(x = y)",q("=",v("x"),v("y")));pt("(x += y)",q("+=",v("x"),v("y")));pt("(x -= y)",q("-=",v("x"),v("y")));pt("(x *= y)",q("*=",v("x"),v("y")));pt("(x /= y)",q("/=",v("x"),v("y")));pt("(x %= y)",q("%=",v("x"),v("y")));pt("(x <<= y)",q("<<=",v("x"),v("y")));pt("(x >>= y)",q(">>=",v("x"),v("y")));pt("(x >>>= y)",q(">>>=",v("x"),v("y")));pt("(x |= y)",q("|=",v("x"),v("y")));pt("(x ^= y)",q("^=",v("x"),v("y")));pt("(x &= y)",q("&=",v("x"),v("y")));pt("(x || y)",U("||",v("x"),v("y")));pt("(x && y)",U("&&",v("x"),v("y")));pt("(w || x || y || z)",U("||",U("||",U("||",v("w"),v("x")),v("y")),v("z")));pt("(x ? y : z)",z(v("x"),v("y"),v("z")));pt("(x,y)",W([v("x"),v("y")]));pt("(x,y,z)",W([v("x"),v("y"),v("z")]));pt("(a,b,c,d,e,f,g)",W([v("a"),v("b"),v("c"),v("d"),v("e"),v("f"),v("g")]));pt("(new Object)",X(v("Object"),[]));pt("(new Object())",X(v("Object"),[]));pt("(new Object(42))",X(v("Object"),[u(42)]));pt("(new Object(1,2,3))",X(v("Object"),[u(1),u(2),u(3)]));pt("(String())",V(v("String"),[]));pt("(String(42))",V(v("String"),[u(42)]));pt("(String(1,2,3))",V(v("String"),[u(1),u(2),u(3)]));pt("[]",$([]));pt("[1]",$([u(1)]));pt("[1,2]",$([u(1),u(2)]));pt("[1,2,3]",$([u(1),u(2),u(3)]));pt("[1,,2,3]",$([u(1),,u(2),u(3)]));pt("[1,,,2,3]",$([u(1),,,u(2),u(3)]));pt("[1,,,2,,3]",$([u(1),,,u(2),,u(3)]));pt("[1,,,2,,,3]",$([u(1),,,u(2),,,u(3)]));pt("[,1,2,3]",$([,u(1),u(2),u(3)]));pt("[,,1,2,3]",$([,,u(1),u(2),u(3)]));pt("[,,,1,2,3]",$([,,,u(1),u(2),u(3)]));pt("[,,,1,2,3,]",$([,,,u(1),u(2),u(3)]));pt("[,,,1,2,3,,]",$([,,,u(1),u(2),u(3),undefined]));pt("[,,,1,2,3,,,]",$([,,,u(1),u(2),u(3),undefined,undefined]));pt("[,,,,,]",$([undefined,undefined,undefined,undefined,undefined]));pt("({})",J([]));pt("({x:1})",J([K(v("x"),u(1),"init")]));pt("({x:1, y:2})",J([K(v("x"),u(1),"init"),K(v("y"),u(2),"init")]));pt("({x:1, y:2, z:3})",J([K(v("x"),u(1),"init"),K(v("y"),u(2),"init"),K(v("z"),u(3),"init")]));pt("({x:1, 'y':2, z:3})",J([K(v("x"),u(1),"init"),K(u("y"),u(2),"init"),K(v("z"),u(3),"init")]));pt("({'x':1, 'y':2, z:3})",J([K(u("x"),u(1),"init"),K(u("y"),u(2),"init"),K(v("z"),u(3),"init")]));pt("({'x':1, 'y':2, 3:3})",J([K(u("x"),u(1),"init"),K(u("y"),u(2),"init"),K(u(3),u(3),"init")]));pt("2 + 3",I("+",u(2),u(3)));pt("typeof(0?0:a)",F("typeof",z(u(0),u(0),v("a"))));n([r(v("f")),N(u(1),f(v("f"),[],x([])),null)]).assert(e.parse("f; if (1) function f(){}"));ht("throw 42",i(u(42)));ht("for (;;) break",y(null,null,null,E(null)));ht("for (x; y; z) break",y(v("x"),v("y"),v("z"),E(null)));ht("for (var x; y; z) break",y(h([c(v("x"),null)]),v("y"),v("z"),E(null)));ht("for (var x = 42; y; z) break",y(h([c(v("x"),u(42))]),v("y"),v("z"),E(null)));ht("for (x; ; z) break",y(v("x"),null,v("z"),E(null)));ht("for (var x; ; z) break",y(h([c(v("x"),null)]),null,v("z"),E(null)));ht("for (var x = 42; ; z) break",y(h([c(v("x"),u(42))]),null,v("z"),E(null)));ht("for (x; y; ) break",y(v("x"),v("y"),null,E(null)));ht("for (var x; y; ) break",y(h([c(v("x"),null)]),v("y"),null,E(null)));ht("for (var x = 42; y; ) break",y(h([c(v("x"),u(42))]),v("y"),null,E(null)));ht("for (var x in y) break",b(h([c(v("x"),null)]),v("y"),E(null)));ht("for (x in y) break",b(v("x"),v("y"),E(null)));ht("{ }",x([]));ht("{ throw 1; throw 2; throw 3; }",x([i(u(1)),i(u(2)),i(u(3))]));ht(";",T);ht("if (foo) throw 42;",N(v("foo"),i(u(42)),null));ht("if (foo) throw 42; else true;",N(v("foo"),i(u(42)),r(u(!0))));ht("if (foo) { throw 1; throw 2; throw 3; }",N(v("foo"),x([i(u(1)),i(u(2)),i(u(3))]),null));ht("if (foo) { throw 1; throw 2; throw 3; } else true;",N(v("foo"),x([i(u(1)),i(u(2)),i(u(3))]),r(u(!0))));ht("foo: for(;;) break foo;",C(v("foo"),y(null,null,null,E(v("foo")))));ht("foo: for(;;) continue foo;",C(v("foo"),y(null,null,null,S(v("foo")))));ht("with (obj) { }",k(v("obj"),x([])));ht("with (obj) { obj; }",k(v("obj"),x([r(v("obj"))])));ht("while (foo) { }",L(v("foo"),x([])));ht("while (foo) { foo; }",L(v("foo"),x([r(v("foo"))])));ht("do { } while (foo);",A(x([]),v("foo")));ht("do { foo; } while (foo)",A(x([r(v("foo"))]),v("foo")));ht("switch (foo) { case 1: 1; break; case 2: 2; break; default: 3; }",O(v("foo"),[M(u(1),[r(u(1)),E(null)]),M(u(2),[r(u(2)),E(null)]),_([r(u(3))])]));ht("switch (foo) { case 1: 1; break; case 2: 2; break; default: 3; case 42: 42; }",O(v("foo"),[M(u(1),[r(u(1)),E(null)]),M(u(2),[r(u(2)),E(null)]),_([r(u(3))]),M(u(42),[r(u(42))])]));ht("try { } catch (e) { }",P(x([]),[],[D(v("e"),null,x([]))],null));ht("try { } catch (e) { } finally { }",P(x([]),[],[D(v("e"),null,x([]))],x([])));ht("try { } finally { }",P(x([]),[],[],x([])));ht("function f() { function g() { } function g() { } }",f(v("f"),[],x([f(v("g"),[],x([])),f(v("g"),[],x([]))])));ht("function f() { function g() { } function g() { return 42 } }",f(v("f"),[],x([f(v("g"),[],x([])),f(v("g"),[],x([s(u(42))]))])));ht("function f() { var x = 42; var x = 43; }",f(v("f"),[],x([h([c(v("x"),u(42))]),h([c(v("x"),u(43))])])));pt("({ get x() { return 42 } })",J([K(v("x"),B(null,[],x([s(u(42))])),"get")]));pt("({ set x(v) { return 42 } })",J([K(v("x"),B(null,[v("v")],x([s(u(42))])),"set")]))}e.testReflect=t})(typeof exports=="undefined"?this:exports);