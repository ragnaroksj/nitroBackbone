$(document).ready(function(){module("Functions");test("functions: bind",function(){var e={name:"moe"},t=function(e){return"name: "+(this.name||e)},n=_.bind(t,e);equals(n(),"name: moe","can bind a function to a context");n=_(t).bind(e);equals(n(),"name: moe","can do OO-style binding");n=_.bind(t,null,"curly");equals(n(),"name: curly","can bind without specifying a context");t=function(e,t){return e+": "+t};t=_.bind(t,this,"hello");equals(t("moe"),"hello: moe","the function was partially applied in advance");var t=_.bind(t,this,"curly");equals(t(),"hello: curly","the function was completely applied in advance");var t=function(e,t,n){return e+": "+t+" "+n};t=_.bind(t,this,"hello","moe","curly");equals(t(),"hello: moe curly","the function was partially applied in advance and can accept multiple arguments");t=function(e,t){equals(this,e,t)};_.bind(t,0,0,"can bind a function to `0`")();_.bind(t,"","","can bind a function to an empty string")();_.bind(t,!1,!1,"can bind a function to `false`")();var r=function(){return this},i=_.bind(r,{hello:"moe curly"});equal((new i).hello,undefined,"function should not be bound to the context, to comply with ECMAScript 5");equal(i().hello,"moe curly","When called without the new operator, it's OK to be bound to the context")});test("functions: bindAll",function(){var e={name:"curly"},t={name:"moe",getName:function(){return"name: "+this.name},sayHi:function(){return"hi: "+this.name}};e.getName=t.getName;_.bindAll(t,"getName","sayHi");e.sayHi=t.sayHi;equals(e.getName(),"name: curly","unbound function is bound to current object");equals(e.sayHi(),"hi: moe","bound function is still bound to original object");e={name:"curly"};t={name:"moe",getName:function(){return"name: "+this.name},sayHi:function(){return"hi: "+this.name}};_.bindAll(t);e.sayHi=t.sayHi;equals(e.sayHi(),"hi: moe","calling bindAll with no arguments binds all functions to the object")});test("functions: memoize",function(){var e=function(t){return t<2?t:e(t-1)+e(t-2)},t=_.memoize(e);equals(e(10),55,"a memoized version of fibonacci produces identical results");equals(t(10),55,"a memoized version of fibonacci produces identical results");var n=function(e){return e},r=_.memoize(n);equals(n("toString"),"toString","checks hasOwnProperty");equals(r("toString"),"toString","checks hasOwnProperty")});asyncTest("functions: delay",2,function(){var e=!1;_.delay(function(){e=!0},100);setTimeout(function(){ok(!e,"didn't delay the function quite yet")},50);setTimeout(function(){ok(e,"delayed the function");start()},150)});asyncTest("functions: defer",1,function(){var e=!1;_.defer(function(t){e=t},!0);_.delay(function(){ok(e,"deferred the function");start()},50)});asyncTest("functions: throttle",2,function(){var e=0,t=function(){e++},n=_.throttle(t,100);n();n();n();setTimeout(n,70);setTimeout(n,120);setTimeout(n,140);setTimeout(n,190);setTimeout(n,220);setTimeout(n,240);_.delay(function(){ok(e==1,"incr was called immediately")},30);_.delay(function(){ok(e==4,"incr was throttled");start()},400)});asyncTest("functions: throttle arguments",2,function(){var e=0,t=function(t){e=t},n=_.throttle(t,100);n(1);n(2);n(3);setTimeout(function(){n(4)},120);setTimeout(function(){n(5)},140);setTimeout(function(){n(6)},250);_.delay(function(){equals(e,1,"updated to latest value")},40);_.delay(function(){equals(e,6,"updated to latest value");start()},400)});asyncTest("functions: throttle once",1,function(){var e=0,t=function(){e++},n=_.throttle(t,100);n();_.delay(function(){ok(e==1,"incr was called once");start()},220)});asyncTest("functions: throttle twice",1,function(){var e=0,t=function(){e++},n=_.throttle(t,100);n();n();_.delay(function(){ok(e==2,"incr was called twice");start()},220)});asyncTest("functions: debounce",1,function(){var e=0,t=function(){e++},n=_.debounce(t,50);n();n();n();setTimeout(n,30);setTimeout(n,60);setTimeout(n,90);setTimeout(n,120);setTimeout(n,150);_.delay(function(){ok(e==1,"incr was debounced");start()},220)});test("functions: once",function(){var e=0,t=_.once(function(){e++});t();t();equals(e,1)});test("functions: wrap",function(){var e=function(e){return"hi: "+e},t=_.wrap(e,function(e,t){return e(t)+" "+t.split("").reverse().join("")});equals(t("moe"),"hi: moe eom","wrapped the saluation function");var n=function(){return"Hello "},r={name:"Moe"};r.hi=_.wrap(n,function(e){return e()+this.name});equals(r.hi(),"Hello Moe");var i=function(){},s=_.wrap(i,function(e){return Array.prototype.slice.call(arguments,0)}),o=s(["whats","your"],"vector","victor");same(o,[i,["whats","your"],"vector","victor"])});test("functions: compose",function(){var e=function(e){return"hi: "+e},t=function(e){return e+"!"},n=_.compose(t,e);equals(n("moe"),"hi: moe!","can compose a function that takes another");n=_.compose(e,t);equals(n("moe"),"hi: moe!","in this case, the functions are also commutative")});test("functions: after",function(){var e=function(e,t){var n=0,r=_.after(e,function(){n++});while(t--)r();return n};equals(e(5,5),1,"after(N) should fire after being called N times");equals(e(5,4),0,"after(N) should not fire unless called N times");equals(e(0,0),1,"after(0) should fire immediately")})});