"use strict";function stdoutEqual(e,t,n){var r="";hooker.hook(process.stdout,"write",{pre:function(e){r+=e;return hooker.preempt()}});t();stdoutUnmute();e.equal(r,n)}function stdoutMute(){hooker.hook(process.stdout,"write",{pre:function(){return hooker.preempt()}})}function stdoutUnmute(){hooker.unhook(process.stdout,"write")}function repeat(e,t,n){var r=e;for(var i=1;i<t;i++)r+=(n||"")+e;return r}var legacyLog=require("../"),Log=legacyLog.Log,hooker=require("hooker"),fooBuffer=new Buffer("foo");exports["Log instance"]={setUp:function(e){this.grunt={fail:{errorcount:0}};e()},write:function(e){e.expect(4);var t=new Log;stdoutEqual(e,function(){t.write("")},"");stdoutEqual(e,function(){t.write("foo")},"foo");stdoutEqual(e,function(){t.write("%s","foo")},"foo");stdoutEqual(e,function(){t.write(fooBuffer)},"foo");e.done()},writeln:function(e){e.expect(4);var t=new Log;stdoutEqual(e,function(){t.writeln()},"\n");stdoutEqual(e,function(){t.writeln("foo")},"foo\n");stdoutEqual(e,function(){t.writeln("%s","foo")},"foo\n");stdoutEqual(e,function(){t.writeln(fooBuffer)},"foo\n");e.done()},warn:function(e){e.expect(5);var t=new Log({grunt:this.grunt});stdoutEqual(e,function(){t.warn()},"ERROR".red+"\n");stdoutEqual(e,function(){t.warn("foo")},">> ".red+"foo\n");stdoutEqual(e,function(){t.warn("%s","foo")},">> ".red+"foo\n");stdoutEqual(e,function(){t.warn(fooBuffer)},">> ".red+"foo\n");e.equal(this.grunt.fail.errorcount,0);e.done()},error:function(e){e.expect(5);var t=new Log({grunt:this.grunt});stdoutEqual(e,function(){t.error()},"ERROR".red+"\n");stdoutEqual(e,function(){t.error("foo")},">> ".red+"foo\n");stdoutEqual(e,function(){t.error("%s","foo")},">> ".red+"foo\n");stdoutEqual(e,function(){t.error(fooBuffer)},">> ".red+"foo\n");e.equal(this.grunt.fail.errorcount,4);e.done()},ok:function(e){e.expect(4);var t=new Log({grunt:this.grunt});stdoutEqual(e,function(){t.ok()},"OK".green+"\n");stdoutEqual(e,function(){t.ok("foo")},">> ".green+"foo\n");stdoutEqual(e,function(){t.ok("%s","foo")},">> ".green+"foo\n");stdoutEqual(e,function(){t.ok(fooBuffer)},">> ".green+"foo\n");e.done()},errorlns:function(e){e.expect(2);var t=new Log({grunt:this.grunt});stdoutEqual(e,function(){t.errorlns(repeat("foo",30," "))},">> ".red+repeat("foo",19," ")+"\n>> ".red+repeat("foo",11," ")+"\n");e.equal(this.grunt.fail.errorcount,1);e.done()},oklns:function(e){e.expect(1);var t=new Log;stdoutEqual(e,function(){t.oklns(repeat("foo",30," "))},">> ".green+repeat("foo",19," ")+"\n>> ".green+repeat("foo",11," ")+"\n");e.done()},success:function(e){e.expect(4);var t=new Log;stdoutEqual(e,function(){t.success()},"".green+"\n");stdoutEqual(e,function(){t.success("foo")},"foo".green+"\n");stdoutEqual(e,function(){t.success("%s","foo")},"foo".green+"\n");stdoutEqual(e,function(){t.success(fooBuffer)},"foo".green+"\n");e.done()},fail:function(e){e.expect(4);var t=new Log;stdoutEqual(e,function(){t.fail()},"".red+"\n");stdoutEqual(e,function(){t.fail("foo")},"foo".red+"\n");stdoutEqual(e,function(){t.fail("%s","foo")},"foo".red+"\n");stdoutEqual(e,function(){t.fail(fooBuffer)},"foo".red+"\n");e.done()},header:function(e){e.expect(5);var t=new Log;stdoutEqual(e,function(){t.header()},"".underline+"\n");stdoutEqual(e,function(){t.header()},"\n"+"".underline+"\n");stdoutEqual(e,function(){t.header("foo")},"\n"+"foo".underline+"\n");stdoutEqual(e,function(){t.header("%s","foo")},"\n"+"foo".underline+"\n");stdoutEqual(e,function(){t.header(fooBuffer)},"\n"+"foo".underline+"\n");e.done()},subhead:function(e){e.expect(5);var t=new Log;stdoutEqual(e,function(){t.subhead()},"".bold+"\n");stdoutEqual(e,function(){t.subhead()},"\n"+"".bold+"\n");stdoutEqual(e,function(){t.subhead("foo")},"\n"+"foo".bold+"\n");stdoutEqual(e,function(){t.subhead("%s","foo")},"\n"+"foo".bold+"\n");stdoutEqual(e,function(){t.subhead(fooBuffer)},"\n"+"foo".bold+"\n");e.done()},writetableln:function(e){e.expect(1);var t=new Log;stdoutEqual(e,function(){t.writetableln([10],[repeat("foo",10)])},"foofoofoof\noofoofoofo\nofoofoofoo\n");e.done()},writelns:function(e){e.expect(1);var t=new Log;stdoutEqual(e,function(){t.writelns(repeat("foo",30," "))},repeat("foo",20," ")+"\n"+repeat("foo",10," ")+"\n");e.done()},writeflags:function(e){e.expect(3);var t=new Log;stdoutEqual(e,function(){t.writeflags(["a","b"])},"Flags: "+"a".cyan+", "+"b".cyan+"\n");stdoutEqual(e,function(){t.writeflags(["a","b"],"Prefix")},"Prefix: "+"a".cyan+", "+"b".cyan+"\n");stdoutEqual(e,function(){t.writeflags({a:!0,b:!1,c:0,d:null},"Prefix")},"Prefix: "+"a".cyan+", "+"b=false".cyan+", "+"c=0".cyan+", "+"d=null".cyan+"\n");e.done()},always:function(e){e.expect(3);var t=new Log;e.strictEqual(t.always,t);e.strictEqual(t.verbose.always,t);e.strictEqual(t.notverbose.always,t);e.done()},or:function(e){e.expect(2);var t=new Log;e.strictEqual(t.verbose.or,t.notverbose);e.strictEqual(t.notverbose.or,t.verbose);e.done()},hasLogged:function(e){e.expect(24);var t=new Log;e.equal(t.hasLogged,!1);e.equal(t.verbose.hasLogged,!1);e.equal(t.notverbose.hasLogged,!1);t.write("");e.equal(t.hasLogged,!0);e.equal(t.verbose.hasLogged,!0);e.equal(t.notverbose.hasLogged,!0);t=new Log({verbose:!0});t.verbose.write("");e.equal(t.hasLogged,!0);e.equal(t.verbose.hasLogged,!0);e.equal(t.notverbose.hasLogged,!0);t=new Log;t.notverbose.write("");e.equal(t.hasLogged,!0);e.equal(t.verbose.hasLogged,!0);e.equal(t.notverbose.hasLogged,!0);stdoutMute();t=new Log({debug:!0});t.debug("");e.equal(t.hasLogged,!0);e.equal(t.verbose.hasLogged,!0);e.equal(t.notverbose.hasLogged,!0);stdoutUnmute();t=new Log;t.verbose.write("");e.equal(t.hasLogged,!1);e.equal(t.verbose.hasLogged,!1);e.equal(t.notverbose.hasLogged,!1);t=new Log({verbose:!0});t.notverbose.write("");e.equal(t.hasLogged,!1);e.equal(t.verbose.hasLogged,!1);e.equal(t.notverbose.hasLogged,!1);t=new Log;t.debug("");e.equal(t.hasLogged,!1);e.equal(t.verbose.hasLogged,!1);e.equal(t.notverbose.hasLogged,!1);e.done()},muted:function(e){e.expect(30);var t=new Log;e.equal(t.muted,!1);e.equal(t.verbose.muted,!1);e.equal(t.notverbose.muted,!1);e.equal(t.options.muted,!1);e.equal(t.verbose.options.muted,!1);e.equal(t.notverbose.options.muted,!1);t.muted=!0;e.equal(t.muted,!0);e.equal(t.verbose.muted,!0);e.equal(t.notverbose.muted,!0);e.equal(t.options.muted,!0);e.equal(t.verbose.options.muted,!0);e.equal(t.notverbose.options.muted,!0);t.muted=!1;e.equal(t.muted,!1);e.equal(t.verbose.muted,!1);e.equal(t.notverbose.muted,!1);e.equal(t.options.muted,!1);e.equal(t.verbose.options.muted,!1);e.equal(t.notverbose.options.muted,!1);t.options.muted=!0;e.equal(t.muted,!0);e.equal(t.verbose.muted,!0);e.equal(t.notverbose.muted,!0);e.equal(t.options.muted,!0);e.equal(t.verbose.options.muted,!0);e.equal(t.notverbose.options.muted,!0);t.options.muted=!1;e.equal(t.muted,!1);e.equal(t.verbose.muted,!1);e.equal(t.notverbose.muted,!1);e.equal(t.options.muted,!1);e.equal(t.verbose.options.muted,!1);e.equal(t.notverbose.options.muted,!1);e.done()},verbose:function(e){e.expect(15);var t=new Log;t.muted=!0;e.strictEqual(t.verbose.write(""),t.verbose);e.strictEqual(t.verbose.writeln(""),t.verbose);e.strictEqual(t.verbose.warn(""),t.verbose);e.strictEqual(t.verbose.error(""),t.verbose);e.strictEqual(t.verbose.ok(""),t.verbose);e.strictEqual(t.verbose.errorlns(""),t.verbose);e.strictEqual(t.verbose.oklns(""),t.verbose);e.strictEqual(t.verbose.success(""),t.verbose);e.strictEqual(t.verbose.fail(""),t.verbose);e.strictEqual(t.verbose.header(""),t.verbose);e.strictEqual(t.verbose.subhead(""),t.verbose);e.strictEqual(t.verbose.debug(""),t.verbose);e.strictEqual(t.verbose.writetableln([]),t.verbose);e.strictEqual(t.verbose.writelns(""),t.verbose);e.strictEqual(t.verbose.writeflags([]),t.verbose);e.done()},notverbose:function(e){e.expect(15);var t=new Log;t.muted=!0;e.strictEqual(t.notverbose.write(""),t.notverbose);e.strictEqual(t.notverbose.writeln(""),t.notverbose);e.strictEqual(t.notverbose.warn(""),t.notverbose);e.strictEqual(t.notverbose.error(""),t.notverbose);e.strictEqual(t.notverbose.ok(""),t.notverbose);e.strictEqual(t.notverbose.errorlns(""),t.notverbose);e.strictEqual(t.notverbose.oklns(""),t.notverbose);e.strictEqual(t.notverbose.success(""),t.notverbose);e.strictEqual(t.notverbose.fail(""),t.notverbose);e.strictEqual(t.notverbose.header(""),t.notverbose);e.strictEqual(t.notverbose.subhead(""),t.notverbose);e.strictEqual(t.notverbose.debug(""),t.notverbose);e.strictEqual(t.notverbose.writetableln([]),t.notverbose);e.strictEqual(t.notverbose.writelns(""),t.notverbose);e.strictEqual(t.notverbose.writeflags([]),t.notverbose);e.done()},"options.debug = true":function(e){e.expect(4);var t=new Log({debug:!0});stdoutEqual(e,function(){t.debug()},"[D] "+"".magenta+"\n");stdoutEqual(e,function(){t.debug("foo")},"[D] "+"foo".magenta+"\n");stdoutEqual(e,function(){t.debug("%s","foo")},"[D] "+"foo".magenta+"\n");stdoutEqual(e,function(){t.debug(fooBuffer)},"[D] "+"foo".magenta+"\n");e.done()},"options.verbose = false":function(e){e.expect(7);var t=new Log({verbose:!1});stdoutEqual(e,function(){t.notverbose.write("foo")},"foo");stdoutEqual(e,function(){t.notverbose.write("%s","foo")},"foo");stdoutEqual(e,function(){t.notverbose.write(fooBuffer)},"foo");stdoutEqual(e,function(){t.verbose.write("foo")},"");stdoutEqual(e,function(){t.verbose.write("%s","foo")},"");stdoutEqual(e,function(){t.verbose.write(fooBuffer)},"");stdoutEqual(e,function(){t.verbose.write("a").or.write("b")},"b");e.done()},"options.verbose = true":function(e){e.expect(7);var t=new Log({verbose:!0});stdoutEqual(e,function(){t.verbose.write("foo")},"foo");stdoutEqual(e,function(){t.verbose.write("%s","foo")},"foo");stdoutEqual(e,function(){t.verbose.write(fooBuffer)},"foo");stdoutEqual(e,function(){t.notverbose.write("foo")},"");stdoutEqual(e,function(){t.notverbose.write("%s","foo")},"");stdoutEqual(e,function(){t.notverbose.write(fooBuffer)},"");stdoutEqual(e,function(){t.notverbose.write("a").or.write("b")},"b");e.done()},"options.debug = false":function(e){e.expect(1);var t=new Log({debug:!1});stdoutEqual(e,function(){t.debug("foo")},"");e.done()},"options.color = true":function(e){e.expect(1);var t=new Log({color:!0});stdoutEqual(e,function(){t.write("foo".blue+"bar".underline)},"foo".blue+"bar".underline);e.done()},"options.color = false":function(e){e.expect(1);var t=new Log({color:!1});stdoutEqual(e,function(){t.write("foo".blue+"bar".underline)},"foobar");e.done()},"perma-bind this when passing grunt in (backcompat)":function(e){e.expect(43);var t=new Log({grunt:this.grunt});stdoutMute();["write","writeln","warn","error","ok","errorlns","oklns","success","fail","header","subhead","debug"].forEach(function(n){var r=t[n],i=t.verbose[n],s=t.notverbose[n];e.equal(r(),t,"Should return log if invoked in a way where this is not log.");e.equal(i(),t.verbose,"Should return log.verbose if invoked in a way where this is not log.");e.equal(s(),t.notverbose,"Should return log.notverbose if invoked in a way where this is not log.")});e.doesNotThrow(function(){var e=t.writetableln;e([])},"Should not throw if invoked in a way where this is not log.");e.doesNotThrow(function(){var e=t.writelns;e([])},"Should not throw if invoked in a way where this is not log.");e.doesNotThrow(function(){var e=t.writeflags;e([])},"Should not throw if invoked in a way where this is not log.");e.doesNotThrow(function(){var e=t.wordlist;e([])},"Should not throw if invoked in a way where this is not log.");e.doesNotThrow(function(){var e=t.uncolor;e("")},"Should not throw if invoked in a way where this is not log.");e.doesNotThrow(function(){var e=t.wraptext;e(1,"")},"Should not throw if invoked in a way where this is not log.");e.doesNotThrow(function(){var e=t.table;e([],"")},"Should not throw if invoked in a way where this is not log.");stdoutUnmute();e.done()}};exports.Helpers={setUp:function(e){e()},uncolor:function(e){e.expect(2);var t=new Log;e.strictEqual(t.uncolor,legacyLog.uncolor);e.equal(legacyLog.uncolor("a".red+"b".bold.green+"c".blue.underline),"abc");e.done()},wordlist:function(e){e.expect(3);var t=new Log;e.strictEqual(t.wordlist,legacyLog.wordlist);e.equal(legacyLog.uncolor(legacyLog.wordlist(["a","b"])),"a, b");e.equal(legacyLog.uncolor(legacyLog.wordlist(["a","b"],{separator:"-"})),"a-b");e.done()},wraptext:function(e){e.expect(9);var t=new Log;e.strictEqual(t.wraptext,legacyLog.wraptext);e.equal(legacyLog.wraptext(2,"aabbc"),"aa\nbb\nc");e.equal(legacyLog.wraptext(2,"aabbcc"),"aa\nbb\ncc");e.equal(legacyLog.wraptext(3,"aaabbbc"),"aaa\nbbb\nc");e.equal(legacyLog.wraptext(3,"aaabbbcc"),"aaa\nbbb\ncc");e.equal(legacyLog.wraptext(3,"aaabbbccc"),"aaa\nbbb\nccc");e.equal(legacyLog.uncolor(legacyLog.wraptext(3,"aaa".blue+"bbb".green+"c".underline)),"aaa\nbbb\nc");e.equal(legacyLog.uncolor(legacyLog.wraptext(3,"aaa".blue+"bbb".green+"cc".underline)),"aaa\nbbb\ncc");e.equal(legacyLog.uncolor(legacyLog.wraptext(3,"aaa".blue+"bbb".green+"ccc".underline)),"aaa\nbbb\nccc");e.done()},table:function(e){e.expect(2);var t=new Log;e.strictEqual(t.table,legacyLog.table);e.equal(legacyLog.table([3,1,5,1,8,1,12,1,20],["a aa aaa aaaa aaaaa","|||||||","b bb bbb bbbb bbbbb","|||||||","c cc ccc cccc ccccc","|||||||","d dd ddd dddd ddddd","|||||||","e ee eee eeee eeeee eeeeee"]),"a  |b bb |c cc ccc|d dd ddd    |e ee eee eeee eeeee \naa |bbb  |cccc    |dddd ddddd  |eeeeee              \naaa|bbbb |ccccc   |            |\naaa|bbbbb|        |            |\na  |     |        |            |\naaa|     |        |            |\naa |     |        |            |");e.done()}};