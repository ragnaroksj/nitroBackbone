function defaults(e){var t=["unlink","chmod","stat","rmdir","readdir"];t.forEach(function(t){e[t]=e[t]||fs[t];t+="Sync";e[t]=e[t]||fs[t]})}function rimraf(e,t,n){if(typeof t=="function"){n=t;t={}}assert(e);assert(t);assert(typeof n=="function");defaults(t);if(!n)throw new Error("No callback passed to rimraf()");var r=0;rimraf_(e,t,function i(s){if(s){if(isWindows&&(s.code==="EBUSY"||s.code==="ENOTEMPTY")&&r<exports.BUSYTRIES_MAX){r++;var o=r*100;return setTimeout(function(){rimraf_(e,t,i)},o)}if(s.code==="EMFILE"&&timeout<exports.EMFILE_MAX)return setTimeout(function(){rimraf_(e,t,i)},timeout++);s.code==="ENOENT"&&(s=null)}timeout=0;n(s)})}function rimraf_(e,t,n){assert(e);assert(t);assert(typeof n=="function");t.unlink(e,function(r){if(r){if(r.code==="ENOENT")return n(null);if(r.code==="EPERM")return isWindows?fixWinEPERM(e,t,r,n):rmdir(e,t,r,n);if(r.code==="EISDIR")return rmdir(e,t,r,n)}return n(r)})}function fixWinEPERM(e,t,n,r){assert(e);assert(t);assert(typeof r=="function");n&&assert(n instanceof Error);t.chmod(e,666,function(i){i?r(i.code==="ENOENT"?null:n):t.stat(e,function(i,s){i?r(i.code==="ENOENT"?null:n):s.isDirectory()?rmdir(e,t,n,r):t.unlink(e,r)})})}function fixWinEPERMSync(e,t,n){assert(e);assert(t);n&&assert(n instanceof Error);try{t.chmodSync(e,666)}catch(r){if(r.code==="ENOENT")return;throw n}try{var i=t.statSync(e)}catch(s){if(s.code==="ENOENT")return;throw n}i.isDirectory()?rmdirSync(e,t,n):t.unlinkSync(e)}function rmdir(e,t,n,r){assert(e);assert(t);n&&assert(n instanceof Error);assert(typeof r=="function");t.rmdir(e,function(i){!i||i.code!=="ENOTEMPTY"&&i.code!=="EEXIST"&&i.code!=="EPERM"?i&&i.code==="ENOTDIR"?r(n):r(i):rmkids(e,t,r)})}function rmkids(e,t,n){assert(e);assert(t);assert(typeof n=="function");t.readdir(e,function(r,i){if(r)return n(r);var s=i.length;if(s===0)return t.rmdir(e,n);var o;i.forEach(function(r){rimraf(path.join(e,r),t,function(r){if(o)return;if(r)return n(o=r);--s===0&&t.rmdir(e,n)})})})}function rimrafSync(e,t){t=t||{};defaults(t);assert(e);assert(t);try{t.unlinkSync(e)}catch(n){if(n.code==="ENOENT")return;if(n.code==="EPERM")return isWindows?fixWinEPERMSync(e,t,n):rmdirSync(e,t,n);if(n.code!=="EISDIR")throw n;rmdirSync(e,t,n)}}function rmdirSync(e,t,n){assert(e);assert(t);n&&assert(n instanceof Error);try{t.rmdirSync(e)}catch(r){if(r.code==="ENOENT")return;if(r.code==="ENOTDIR")throw n;(r.code==="ENOTEMPTY"||r.code==="EEXIST"||r.code==="EPERM")&&rmkidsSync(e,t)}}function rmkidsSync(e,t){assert(e);assert(t);t.readdirSync(e).forEach(function(n){rimrafSync(path.join(e,n),t)});t.rmdirSync(e,t)}module.exports=rimraf;rimraf.sync=rimrafSync;var assert=require("assert"),path=require("path"),fs=require("fs"),timeout=0;exports.EMFILE_MAX=1e3;exports.BUSYTRIES_MAX=3;var isWindows=process.platform==="win32";